(()=>{function e(e){return e&&e.__esModule?e.default:e}const t=e=>"V"===e,i={1027:"Sponsored Display DRA"},n={1:"Enabled",0:"NotEnabled","-1":"Unknown"},r=e=>o(e),s=e=>a(e),a=e=>btoa(unescape(encodeURIComponent(e))),o=e=>decodeURIComponent(escape(atob(e))),l=e=>e&&0===Object.keys(e).length&&e.constructor===Object,d="video",c={START:`${d}:setup:start`,PARSED:`${d}:setup:parsed`,RENDERED:`${d}:setup:rendered`,DONE:`${d}:setup:done`},u=`${d}:pixel`;function h(){return void 0!==window.SFClient&&window.SFClient||void 0!==window.MSFClient&&window.MSFClient}const p={};function m(e,t){p[e]||(g(e,t),p[e]=!0)}function g(e,t){t.forEach((e=>{(new Image).src=e})),h().countMetric(`${u}:${e}`,1,!1)}const v={VAST_VALIDATION:101,UNEXPECTED_AD_TYPE:200,UNEXPECTED_LINEARITY:201,URI_TIMEOUT:301,WRAPPER_LIMIT:302,NO_AD:303,UNSUPPORTED_MEDIA_FILES:403,UNDEFINED:900},f=(e,t)=>{g(`error:${e}`,t.map((t=>t.replace("[ERRORCODE]",e)))),h().handleFallbackBehavior()};function w(e){return"true"===e.abpAcceptable&&("1"===e.abpStatus||"-1"===e.abpStatus)}const _=()=>{const e=window.navigator;return(null==e?void 0:e.connection)||(null==e?void 0:e.mozConnection)||(null==e?void 0:e.webkitConnection)},y=()=>{var e;const t=null===(e=_())||void 0===e?void 0:e.saveData;return t||!1},x=()=>{var e;const t=null===(e=_())||void 0===e?void 0:e.downlink;return!!t&&t<5},b=e=>!w(e)&&!y()&&!x(),k=s('<?xml version="1.0" encoding="UTF-8"?>\n    <svg width="36px" height="36px" viewBox="0 0 36 36" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <title>Playicon</title>\n        <g id="design-specs" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n            <g id="2-copy" transform="translate(-1854.000000, -1262.000000)">\n                <g id="Playicon" transform="translate(1854.000000, 1262.000000)">\n                    <rect id="Rectangle" x="0" y="0" width="36" height="36"></rect>\n                    <polygon id="play" fill="#000000" points="12.6842172 10 12.6842172 25 23.9300441 17.5"></polygon>\n                </g>\n            </g>\n        </g>\n    </svg>'),C=s('<?xml version="1.0" encoding="UTF-8"?>\n    <svg width="36px" height="36px" viewBox="0 0 36 36" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <title>Pauseicon</title>\n        <g id="design-specs" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n            <g id="2-copy" transform="translate(-1854.000000, -1348.000000)">\n                <g id="Pauseicon" transform="translate(1854.000000, 1348.000000)">\n                    <rect id="Rectangle" x="0" y="0" width="36" height="36"></rect>\n                    <path d="M16,10 L16,25 L12,25 L12,10 L16,10 Z M23,10 L23,25 L19,25 L19,10 L23,10 Z" id="pause" fill="#000000"></path>\n                </g>\n            </g>\n        </g>\n    </svg>'),E=s('<?xml version="1.0" encoding="UTF-8"?>\n    <svg width="37px" height="36px" viewBox="0 0 37 36" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <title>Muteicon@3x</title>\n        <g id="design-specs" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n            <g id="2-copy" transform="translate(-1854.000000, -1521.000000)">\n                <g id="Muteicon" transform="translate(1854.179188, 1521.000000)">\n                    <rect id="Rectangle" x="0" y="0" width="36" height="36"></rect>\n                    <path d="M24.6221654,12 C27.9113551,15.0694345 27.9113551,20.0458684 24.6221654,23.1153029" id="Stroke-5" stroke="#000000" stroke-linecap="round" stroke-linejoin="round"></path>\n                    <path d="M22.1552731,14.4700673 C23.7998679,16.1753444 23.7998679,18.9400697 22.1552731,20.6452356" id="Stroke-6" stroke="#000000" stroke-linecap="round" stroke-linejoin="round"></path>\n                    <polygon id="Stroke-1" stroke="#000000" stroke-linecap="round" stroke-linejoin="round" points="13.5211501 20.6130286 18.4549346 23.1153029 18.4549346 12 13.5211501 14.5022744"></polygon>\n                    <polygon id="Stroke-3" stroke="#000000" stroke-linecap="round" stroke-linejoin="round" points="9.82081164 20.6452356 13.5211501 20.6452356 13.5211501 14.4700673 9.82081164 14.4700673"></polygon>\n                </g>\n            </g>\n        </g>\n    </svg>'),T=s('<?xml version="1.0" encoding="UTF-8"?>\n    <svg width="37px" height="36px" viewBox="0 0 37 36" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <title>Unmuteicon</title>\n        <g id="design-specs" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n            <g id="2-copy" transform="translate(-1854.000000, -1432.000000)">\n                <g id="audio_off-copy-42" transform="translate(1854.179188, 1432.000000)">\n                    <rect id="Rectangle" x="0" y="0" width="36" height="36"></rect>\n                    <polygon id="Stroke-1" stroke="#000000" stroke-linecap="round" stroke-linejoin="round" points="12.6 20.5236826 17.4 23 17.4 12 12.6 14.4763174"></polygon>\n                    <polygon id="Stroke-3" stroke="#000000" stroke-linecap="round" stroke-linejoin="round" points="9 20.5555556 12.6 20.5555556 12.6 14.4444444 9 14.4444444"></polygon>\n                    <line x1="27" y1="14.4444444" x2="21" y2="20.5555556" id="Stroke-5" stroke="#000000" stroke-linecap="round" stroke-linejoin="round"></line>\n                    <line x1="21" y1="14.4444444" x2="27" y2="20.5555556" id="Stroke-6" stroke="#000000" stroke-linecap="round" stroke-linejoin="round"></line>\n                </g>\n            </g>\n        </g>\n    </svg>'),A=s('<?xml version="1.0" encoding="UTF-8"?>\n    <svg width="86px" height="86px" viewBox="0 0 86 86" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <title>Replaylarge</title>\n        <defs>\n            <circle id="path-1" cx="32.5" cy="32.5" r="32.5"></circle>\n            <filter x="-10.8%" y="-10.8%" width="121.5%" height="121.5%" filterUnits="objectBoundingBox" id="filter-2">\n                <feOffset dx="0" dy="-2" in="SourceAlpha" result="shadowOffsetOuter1"></feOffset>\n                <feGaussianBlur stdDeviation="6" in="shadowOffsetOuter1" result="shadowBlurOuter1"></feGaussianBlur>\n                <feColorMatrix values="0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 0.117160184 0" type="matrix" in="shadowBlurOuter1"></feColorMatrix>\n            </filter>\n            <filter x="-17.6%" y="-17.6%" width="135.3%" height="135.3%" filterUnits="objectBoundingBox" id="filter-3">\n                <feOffset dx="0" dy="2" in="SourceAlpha" result="shadowOffsetOuter1"></feOffset>\n                <feGaussianBlur stdDeviation="2" in="shadowOffsetOuter1" result="shadowBlurOuter1"></feGaussianBlur>\n                <feColorMatrix values="0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 0.113745629 0" type="matrix" in="shadowBlurOuter1" result="shadowMatrixOuter1"></feColorMatrix>\n                <feMerge>\n                    <feMergeNode in="shadowMatrixOuter1"></feMergeNode>\n                    <feMergeNode in="SourceGraphic"></feMergeNode>\n                </feMerge>\n            </filter>\n        </defs>\n        <g id="design-specs" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n            <g id="2-copy" transform="translate(-1829.000000, -1016.000000)">\n                <g id="Replaylarge" transform="translate(1838.000000, 1025.000000)">\n                    <g id="Group-7-Copy">\n                        <g id="Oval" opacity="0">\n                            <use fill="black" fill-opacity="1" filter="url(#filter-2)" xlink:href="#path-1"></use>\n                            <use fill="#FFFFFF" fill-rule="evenodd" xlink:href="#path-1"></use>\n                        </g>\n                        <g id="Group-9" filter="url(#filter-3)" opacity="0.600260417" fill="#000000">\n                            <circle id="Oval" cx="34" cy="34" r="34"></circle>\n                        </g>\n                    </g>\n                    <g id="Group-10-Copy" transform="translate(9.196588, 9.196588)" fill="#FFFFFF">\n                        <path d="M10.451133,4.42453923 L21.8112559,5.76493334 C22.0854959,5.79729124 22.28158,6.04583794 22.2492221,6.32007794 C22.2452732,6.35354565 22.2379509,6.38652839 22.2273669,6.41852305 L18.8918348,16.50153 C18.8051072,16.7636996 18.5222701,16.9059235 18.2601004,16.8191958 C18.1581301,16.7854633 18.0697322,16.7197921 18.007994,16.6319046 L9.98340309,5.20850356 C9.82467155,4.98254138 9.87917275,4.67068549 10.1051349,4.51195395 C10.2057887,4.44124775 10.3289741,4.41012556 10.451133,4.42453923 Z" id="Path-2" transform="translate(15.880237, 10.869527) rotate(182.000000) translate(-15.880237, -10.869527) "></path>\n                        <path d="M24.8034125,6.80341249 C26.4591838,6.80341249 28.0627387,7.02697758 29.5855378,7.44556833 C30.2352058,8.8758351 30.227597,10.2631459 29.5641307,11.6071753 C28.0660495,11.0586533 26.4478766,10.7599342 24.7599342,10.7599342 C17.0279477,10.7599342 10.7599342,17.0279477 10.7599342,24.7599342 C10.7599342,32.4919207 17.0279477,38.7599342 24.7599342,38.7599342 C32.4919207,38.7599342 38.7599342,32.4919207 38.7599342,24.7599342 C38.7599342,24.0762755 38.7109308,23.4040621 38.6162448,22.746615 C39.8120753,22.1227551 41.1884405,22.0625144 42.636719,22.3502857 C42.7469339,23.1521556 42.8034125,23.9711884 42.8034125,24.8034125 C42.8034125,34.744538 34.744538,42.8034125 24.8034125,42.8034125 C14.862287,42.8034125 6.80341249,34.744538 6.80341249,24.8034125 C6.80341249,14.862287 14.862287,6.80341249 24.8034125,6.80341249 Z" id="loading-copy" transform="translate(24.803412, 24.803412) rotate(-122.000000) translate(-24.803412, -24.803412) "></path>\n                    </g>\n                </g>\n            </g>\n        </g>\n    </svg>'),P=s('<?xml version="1.0" encoding="UTF-8"?>\n    <svg width="68px" height="68px" viewBox="0 0 68 68" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <title>Playoverlaylarge</title>\n        <g id="design-specs" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n            <g id="2-copy" transform="translate(-1838.000000, -776.000000)">\n                <g id="Playoverlaylarge" transform="translate(1838.000000, 776.000000)">\n                    <g id="Group-7-Copy">\n                        <g id="Oval" opacity="0" transform="translate(4.857143, 4.857143)">\n                            <g id="path-1-link" fill="#000000" fill-rule="nonzero">\n                                <circle id="path-1" cx="29.1428571" cy="29.1428571" r="29.1428571"></circle>\n                            </g>\n                            <g id="path-1-link" fill="#FFFFFF">\n                                <circle id="path-1" cx="29.1428571" cy="29.1428571" r="29.1428571"></circle>\n                            </g>\n                        </g>\n                        <g id="Group-9" opacity="0.595284598" fill="#000000" fill-rule="nonzero">\n                            <circle id="Oval" cx="34" cy="34" r="34"></circle>\n                        </g>\n                    </g>\n                    <polygon id="Stroke-1" stroke="#FFFFFF" stroke-width="1.25" fill="#FFFFFF" fill-rule="nonzero" stroke-linecap="round" stroke-linejoin="round" points="25 49 25 20 48 34.367378"></polygon>\n                </g>\n            </g>\n        </g>\n    </svg>'),S=s('<?xml version="1.0" encoding="UTF-8"?>\n    <svg width="36px" height="36px" viewBox="0 0 36 36" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <title>loading copy 2</title>\n        <g id="design-specs" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n            <g id="2-copy" transform="translate(-1107.000000, -1515.000000)" fill="#FFFFFF">\n                <path d="M1125,1515 C1126.65577,1515 1128.25933,1515.22357 1129.78213,1515.64216 C1130.43179,1517.07242 1130.42418,1518.45973 1129.76072,1519.80376 C1128.26264,1519.25524 1126.64446,1518.95652 1124.95652,1518.95652 C1117.22454,1518.95652 1110.95652,1525.22454 1110.95652,1532.95652 C1110.95652,1540.68851 1117.22454,1546.95652 1124.95652,1546.95652 C1132.68851,1546.95652 1138.95652,1540.68851 1138.95652,1532.95652 C1138.95652,1532.27286 1138.90752,1531.60065 1138.81283,1530.9432 C1140.00866,1530.31934 1141.38503,1530.2591 1142.83331,1530.54687 C1142.94352,1531.34874 1143,1532.16778 1143,1533 C1143,1542.94113 1134.94113,1551 1125,1551 C1115.05887,1551 1107,1542.94113 1107,1533 C1107,1523.05887 1115.05887,1515 1125,1515 Z" id="loading-copy-2"></path>\n            </g>\n        </g>\n    </svg>');function I(e){return`data:image/svg+xml;base64,${e}`}function F(e,t,i,n,r){const s=i;if(n&&t.size){const e=`${parseInt(t.size.width)}x${parseInt(t.size.height)}`;n[e]&&Object.assign(s,n[e])}r&&t.expParams&&t.expParams.videoPlayerStyles&&t.expParams.videoPlayerStyles[r]&&Object.assign(s,t.expParams.videoPlayerStyles[r]);for(const a of Object.keys(s))e.style.setProperty(a,s[a])}const M={CONTAINER:"container",VIDEO:"video",CONTROLS_WRAPPER:"controlsWrapper",PROGRESS_BAR_WRAPPER:"progressBarWrapper",PROGRESS_BAR_CURRENT:"progressBarCurrent",PROGRESS_TEXT:"progressText",PLAY_BUTTON:"playButton",SOUND_BUTTON:"soundButton",CTA_BUTTON:"ctaButton",REPLAY_WRAPPER:"replayWrapper",REPLAY_BUTTON:"replayButton"};function R(e){const t=document.createElement("img");return t.src=I(k),t.tabIndex=0,t.setAttribute("role","button"),F(t,e,{display:"block",cursor:"pointer",position:"absolute",bottom:"10%",left:0},{"300x250":{width:"12%"},"414x283":{width:"8.7%"}},M.PLAY_BUTTON),t}function L(e){const t=document.createElement("div");F(t,e,{display:"block",position:"absolute",top:0,left:0,width:"100%","background-color":"#cccccc"},{"300x250":{height:"4%"},"414x283":{height:"5%"}},M.PROGRESS_BAR_WRAPPER);const i=document.createElement("div");return F(i,e,{display:"block",position:"relative",top:0,left:0,width:0,height:"100%","background-color":"#000000"},null,M.PROGRESS_BAR_CURRENT),t.appendChild(i),{wrapper:t,current:i}}function O(e){const t=document.createElement("div");return F(t,e,{display:"block",position:"absolute",color:"#000000"},{"300x250":{top:"28%",left:"15%"},"414x283":{top:"30%",left:"25%"}},M.PROGRESS_TEXT),t}function N(e){const t=document.createElement("img");return t.src=I(T),t.tabIndex=0,t.setAttribute("role","button"),F(t,e,{display:"block",cursor:"pointer",position:"absolute",bottom:"10%"},{"300x250":{right:0,width:"12%"},"414x283":{left:"10%",width:"8.7%"}},M.SOUND_BUTTON),t}function D(e){const t=document.createElement("div");F(t,e,{display:"block",position:"relative",top:"3%"},{"300x250":{left:"1.6%",width:"96.8%",height:"17%"},"414x283":{left:"3.6%",width:"92.8%",height:"14%"}},M.CONTROLS_WRAPPER);const{wrapper:i,current:n}=L(e);t.appendChild(i);const r=O(e);t.appendChild(r);const s=R(e);t.appendChild(s);const a=N(e);return t.appendChild(a),{wrapper:t,progressBar:n,progressText:r,playButton:s,soundButton:a}}const U=e=>{const t=document.createElement("a");return t.tabIndex=0,F(t,e,{display:"block",cursor:"pointer",position:"absolute",color:"#057387"},{"300x250":{bottom:"2%",left:"3%"},"414x283":{bottom:"4%",right:"5%"}},M.CTA_BUTTON),t.innerHTML=`Shop ${B(e)} &rsaquo;`,t},B=e=>e.brandNameEncoded?r(e.brandNameEncoded):"the store on Amazon";function V(e){const t=document.createElement("div");F(t,e,{display:"flex","justify-content":"center","align-items":"center",position:"absolute",top:0,left:0,width:"100%","background-color":"#00000099"},{"300x250":{height:"67%"},"414x283":{height:"82%"}},M.REPLAY_WRAPPER);const i=document.createElement("img");return i.src=I(S),i.tabIndex=0,i.setAttribute("role","button"),F(i,e,{display:"block",cursor:"pointer"},{"300x250":{width:"18.6%"},"414x283":{width:"16.4%"}},M.REPLAY_BUTTON),t.appendChild(i),{overlay:t,overlayButton:i}}var H={},W={};Object.defineProperty(W,"__esModule",{value:!0}),W.ERRORS=void 0;var $={};Object.defineProperty($,"__esModule",{value:!0}),$.default={100:"XML parsing error.",101:"VAST schema validation error.",102:"VAST version of response not supported.",200:"Trafficking error. Video player received an ad type that it was not expecting and/or cannot display.",201:"Video player expecting different linearity.",202:"Video player expecting different duration.",203:"Video player expecting different size.",300:"General Wrapper error.",301:"Timeout of VAST URI provided in Wrapper element, or of VAST URI provided in a subsequent Wrapper element.",302:"Wrapper limit reached, as defined by the video player. Too many Wrapper responses have been received with no InLine response.",303:"No ads VAST response after one or more Wrappers. Also includes number of empty VAST responses from fallback.",400:"General linear error. Video player is unable to display the linear ad.",401:"File not found. Unable to find Linear/MediaFile from URI.",402:"Timeout of MediaFile URI.",403:"Could not find MediaFile that is supported by this video player, based on the attributes of the MediaFile element.",405:"Problem displaying MediaFile.",406:"Mezzanine was required but not provided. Ad not served.",407:"Mezzanine is in the process of being downloaded for the first time. Download may take several hours. Ad will not be served until mezzanine is downloaded and transcoded.",408:"Conditional ad rejected.",409:"Interactive unit in the InteractiveCreativeFile node was not executed",410:"Verification unit in the Verification node was not executed.",411:"Mezzanine was provided as required, but file did not meet required specification. Ad not served.",500:"General NonLinearAds error.",501:"Unable to display NonLinear Ad because creative dimensions do not align with creative display area.",502:"Unable to fetch NonLinearAds/NonLinear resource.",503:"Could not find NonLinearresource with supported type.",600:"General CompanionAds error.",601:"Unable to display companion because creative dimensions do not fit within Companion display area.",602:"Unable to display Required Companion.",603:"Unable to fetch CompanionAds/Companion resource.",604:"Could not find Companion resource with supported type.",900:"Undefined error.",901:"General VPAID error."};var j,z,q,G,X,Y=ee($),J={};function Q(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}j=J,Object.defineProperty(j,"__esModule",{value:!0,configurable:!0}),z=J,q="default",G=()=>K,Object.defineProperty(z,q,{get:G,set:X,enumerable:!0,configurable:!0});var K=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=Q(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return Object.defineProperty(i,"message",{configurable:!0,enumerable:!1,value:e,writable:!0}),Object.defineProperty(i,"name",{configurable:!0,enumerable:!1,value:i.constructor.name,writable:!0}),Error.hasOwnProperty("captureStackTrace")?(Error.captureStackTrace(i,i.constructor),Q(i)):(Object.defineProperty(i,"stack",{configurable:!0,enumerable:!1,value:new Error(e).stack,writable:!0}),i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(function(e){function t(){e.apply(this,arguments)}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error)),Z=ee(J);function ee(e){return e&&e.__esModule?e:{default:e}}W.ERRORS=Y.default;var te=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:900;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"VAST error "+e+(e in Y.default?": "+Y.default[e]:"")));return i.code=e,i.$type="VASTError",i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(Z.default);W.default=te,(H=W.default).ERRORS=W.ERRORS;const ie=["application/x-mpegURL","video/webm","video/ogg","video/mp4"],ne=2e3,re=1e4;function se(t){var i;const n=[],r=t.expParams&&t.expParams.videoMediaCriteria,s=r&&r.types||ie,a=r&&r.minBitrate||ne,o=r&&r.maxBitrate||re,l=function(e){const t={};for(const i of e){const e=i.type;t[e]||(t[e]=[]),t[e].push(i)}return t}(null===(i=t.vast)||void 0===i?void 0:i.mediaFiles);for(const e of s)if(l[e]){const t=ae(l[e],a,o);t&&n.push(t)}if(0===n.length)throw new(e(H))(v.UNSUPPORTED_MEDIA_FILES);return n}function ae(e,t,i){let n=null;for(const r of e)oe(r,t,i)&&(!n||le(r)>le(n))&&(n=r);return n}function oe(e,t,i){return null!=e.bitrate?e.bitrate>=t&&e.bitrate<=i:null!=e.minBitrate&&null!=e.maxBitrate&&(e.minBitrate>=t&&e.maxBitrate<=i)}function le(e){return null!=e.bitrate?e.bitrate:null!=e.minBitrate&&null!=e.maxBitrate?Math.floor((e.minBitrate+e.maxBitrate)/2):0}function de(e){const t=document.createElement("video");t.muted=!0,t.playsInline=!0,t.preload="metadata",F(t,e,{position:"relative",cursor:"pointer",top:0,left:0,width:"100%"},{"300x250":{"min-height":"67%"},"414x283":{"min-height":"82%"}},M.VIDEO);for(const i of se(e)){const e=document.createElement("source");e.type=i.type,e.src=i.uri,t.appendChild(e)}return t}function ce(e){const t=document.createElement("div");F(t,e,{display:"block",position:"relative",top:0,left:0,width:"100vw",height:"100vh",border:"1px solid #cccccc","box-sizing":"border-box","background-color":"#ffffff","font-family":'"Amazon Ember", Arial, sans-serif'},{"300x250":{"font-size":"5.2vh"},"414x283":{"font-size":"4.6vh"}},M.CONTAINER);const i=de(e),{wrapper:n,progressBar:r,progressText:s,playButton:a,soundButton:o}=D(e),l=U(e),{overlay:d,overlayButton:c}=V(e);return t.appendChild(i),t.appendChild(d),t.appendChild(n),t.appendChild(l),{container:t,videoElement:i,progressBar:r,progressText:s,playButton:a,soundButton:o,ctaButton:l,overlay:d,overlayButton:c}}function ue(e,t){const i=he(e),n=he(t);return`${pe(i.minutes,1)}:${pe(i.seconds,2)} / ${pe(n.minutes,1)}:${pe(n.seconds,2)}`}function he(e){return{minutes:e/60,seconds:e%60}}function pe(e,t){return`0${Math.floor(e)}`.slice(-t)}const me=/^((https?:)?\/\/)(.*\.)?amazon\./,ge=e=>{me.test(e)?setTimeout((()=>{window.open(e,"_top")}),150):window.open(e,"_blank")};function ve(e,t){e.addEventListener("click",t),e.addEventListener("keydown",(e=>{"Enter"!==e.key&&" "!==e.key&&"Spacebar"!==e.key||(e.preventDefault(),t(e))}))}const fe="play",we="wait",_e="stop";class ye{get currentState(){return this._currentState}get playStartTimeInSeconds(){return this._playStartTimeInSeconds}transitionToPlayState(e){this._isCurrentlyInStopState()&&(this._playStartTimeInSeconds=e),this._currentState=fe}transitionToWaitState(e){this._isCurrentlyInStopState()&&(this._playStartTimeInSeconds=e),this._currentState=we}transitionToStopState(){this._currentState=_e}getPlayingTimeInSeconds(e){return this._isCurrentlyInStopState()||void 0===this._playStartTimeInSeconds?0:e-this._playStartTimeInSeconds}_isCurrentlyInStopState(){return this._currentState===_e}constructor(){this._playStartTimeInSeconds=void 0,this._currentState=_e}}function xe(e,t){const{container:i,videoElement:n,progressBar:s,progressText:a,playButton:o,soundButton:l,ctaButton:d,overlay:c,overlayButton:u}=ce(t);let p=!1,v=!1,f=!1;const w=b(t),_=new ye,y=e=>{c.style.display="flex",u.src=I(e)},x=()=>{c.style.display="none"},F=()=>(n.paused?(p=!0,n.play(),o.src=I(C),x()):(n.pause(),o.src=I(k)),!n.paused),M=()=>{y(S)},R=()=>{m("clickThrough",e.clickTrackingPixels),ge(e.clickThroughUrl)},L=()=>{const e=_.getPlayingTimeInSeconds(n.currentTime);h().updatePlayingTimeForVideo(e)};if(n.addEventListener("loadedmetadata",(()=>{a.innerText=ue(n.currentTime,n.duration),m("impression",e.impressionPixels),h().requestVideoAutoplay({minVisiblePercentForLeader:.5}),f&&w?F():y(P)})),n.addEventListener("waiting",(()=>{_.transitionToWaitState(n.currentTime),L(),M()})),n.addEventListener("seeking",(()=>{_.transitionToStopState(),L(),M()})),n.addEventListener("stalled",(()=>{M()})),n.addEventListener("playing",(()=>{x()})),n.addEventListener("click",(()=>{R()})),n.addEventListener("play",(()=>{_.transitionToPlayState(n.currentTime),L()})),n.addEventListener("pause",(()=>{_.transitionToStopState(),L()})),n.addEventListener("stop",(()=>{_.transitionToStopState(),L()})),n.addEventListener("timeupdate",(()=>{_.transitionToPlayState(n.currentTime),L();const t=n.currentTime/n.duration;s.style.width=`${(100*t).toFixed(0)}%`,a.innerText=ue(n.currentTime,n.duration),t>.75?m("thirdQuartile",e.trackingEvents.thirdQuartile):t>.5?m("midpoint",e.trackingEvents.midpoint):t>.25?m("firstQuartile",e.trackingEvents.firstQuartile):m("start",e.trackingEvents.start)})),n.addEventListener("ended",(()=>{_.transitionToStopState(),L(),y(A),o.src=I(k),m("complete",e.trackingEvents.complete),f&&h().releaseVideoAutoplay()})),ve(o,(()=>{if(n.ended)g("rewind",e.trackingEvents.rewind);else{const t=n.paused?"resume":"pause";g(t,e.trackingEvents[t])}v=!F(),v?f&&h().releaseVideoAutoplay():h().haveVideoAutoplayPermission()})),ve(l,(()=>{const t=(n.muted=!n.muted,l.src=I(n.muted?T:E),n.muted?"mute":"unmute");g(t,e.trackingEvents[t])})),ve(d,(()=>{R()})),ve(u,(()=>{p&&g("rewind",e.trackingEvents.rewind),v=!F(),v||h().haveVideoAutoplayPermission()})),h().registerCustomMessageListener("videoAutoplayResponse",(e=>{f=e,f&&!p?p=w:f||n.paused||F()})),setInterval((()=>{var e;if(p){const t=(null===window||void 0===window?void 0:window.$sf)&&(null===(e=window.$sf.ext)||void 0===e?void 0:e.inViewPercentage)&&window.$sf.ext.inViewPercentage()>=50;(!t&&!n.paused||t&&!n.ended&&n.paused&&!v&&f)&&F()}}),100),document.body.appendChild(i),"string"==typeof t.measurementHtmlEncoded){const e=r(t.measurementHtmlEncoded);document.body.appendChild(document.createRange().createContextualFragment(e))}}var be,ke=Object.prototype.hasOwnProperty,Ce="~";function Ee(){}function Te(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function Ae(e,t,i,n,r){if("function"!=typeof i)throw new TypeError("The listener must be a function");var s=new Te(i,n||e,r),a=Ce?Ce+t:t;return e._events[a]?e._events[a].fn?e._events[a]=[e._events[a],s]:e._events[a].push(s):(e._events[a]=s,e._eventsCount++),e}function Pe(e,t){0==--e._eventsCount?e._events=new Ee:delete e._events[t]}function Se(){this._events=new Ee,this._eventsCount=0}Object.create&&(Ee.prototype=Object.create(null),(new Ee).__proto__||(Ce=!1)),Se.prototype.eventNames=function(){var e,t,i=[];if(0===this._eventsCount)return i;for(t in e=this._events)ke.call(e,t)&&i.push(Ce?t.slice(1):t);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},Se.prototype.listeners=function(e){var t=Ce?Ce+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,r=i.length,s=new Array(r);n<r;n++)s[n]=i[n].fn;return s},Se.prototype.listenerCount=function(e){var t=Ce?Ce+e:e,i=this._events[t];return i?i.fn?1:i.length:0},Se.prototype.emit=function(e,t,i,n,r,s){var a=Ce?Ce+e:e;if(!this._events[a])return!1;var o,l,d=this._events[a],c=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),c){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,i),!0;case 4:return d.fn.call(d.context,t,i,n),!0;case 5:return d.fn.call(d.context,t,i,n,r),!0;case 6:return d.fn.call(d.context,t,i,n,r,s),!0}for(l=1,o=new Array(c-1);l<c;l++)o[l-1]=arguments[l];d.fn.apply(d.context,o)}else{var u,h=d.length;for(l=0;l<h;l++)switch(d[l].once&&this.removeListener(e,d[l].fn,void 0,!0),c){case 1:d[l].fn.call(d[l].context);break;case 2:d[l].fn.call(d[l].context,t);break;case 3:d[l].fn.call(d[l].context,t,i);break;case 4:d[l].fn.call(d[l].context,t,i,n);break;default:if(!o)for(u=1,o=new Array(c-1);u<c;u++)o[u-1]=arguments[u];d[l].fn.apply(d[l].context,o)}}return!0},Se.prototype.on=function(e,t,i){return Ae(this,e,t,i,!1)},Se.prototype.once=function(e,t,i){return Ae(this,e,t,i,!0)},Se.prototype.removeListener=function(e,t,i,n){var r=Ce?Ce+e:e;if(!this._events[r])return this;if(!t)return Pe(this,r),this;var s=this._events[r];if(s.fn)s.fn!==t||n&&!s.once||i&&s.context!==i||Pe(this,r);else{for(var a=0,o=[],l=s.length;a<l;a++)(s[a].fn!==t||n&&!s[a].once||i&&s[a].context!==i)&&o.push(s[a]);o.length?this._events[r]=1===o.length?o[0]:o:Pe(this,r)}return this},Se.prototype.removeAllListeners=function(e){var t;return e?(t=Ce?Ce+e:e,this._events[t]&&Pe(this,t)):(this._events=new Ee,this._eventsCount=0),this},Se.prototype.off=Se.prototype.removeListener,Se.prototype.addListener=Se.prototype.on,Se.prefixed=Ce,Se.EventEmitter=Se,be=Se;const Ie=e=>t=>t.nodeType===e,Fe=Ie(1),Me=Ie(3),Re=Ie(4),Le=(e,t)=>Array.prototype.filter.call(e.childNodes,t),Oe=e=>Me(e)||Re(e),Ne=e=>Le(e,Oe).map((e=>e.nodeValue)).join("").trim();var De={bool:"b",int:"i",float:"f",time:"t"};const Ue=/^\s*(\d+):(\d+):(\d+(?:\.\d+)?)\s*$/;var Be=e=>{if("string"!=typeof e)return null;const t=Ue.exec(e);return null==t?null:60*(60*parseInt(t[1],10)+parseInt(t[2],10))+parseFloat(t[3])},Ve={[De.bool]:e=>"true"===e||"1"===e,[De.int]:e=>parseInt(e,10),[De.float]:parseFloat,[De.time]:Be};const He=(()=>{const e=/^[A-Z]+/,t=e=>1===e.length?e.toLowerCase():e.substr(0,e.length-1).toLowerCase()+e.charAt(e.length-1);return i=>i.replace(e,t)})(),We=(e,t,i)=>null!=e[t]&&~e[t].indexOf(i);class $e{unmarshal(e){return this._createNode(e)}_createNode(e){const t=Object.create(null);return t._value=this._isHybrid(e.nodeName)?e:this._convertPropertyValue(Ne(e),e.nodeName,"_value"),this._copyAttributes(t,e),this._createCollections(t,e),this._createChildren(t,e),t}_createFreeformNode(e){const t=Object.create(null);return this._copyAttributes(t,e),t._value=e,t}_copyAttributes(e,t){const i=t.nodeName;for(let n=0;n<t.attributes.length;++n){const r=t.attributes[n],s=r.nodeName,a=r.nodeValue;e[s]=this._convertPropertyValue(a,i,s)}}_createCollections(e,t){null!=this._collections[t.nodeName]&&this._collections[t.nodeName].forEach((t=>{e[He(t)]=[]}))}_createChildren(e,t){const i=t.nodeName;Le(t,Fe).forEach((t=>{const n=t.nodeName,r=He(n);this._isFreeformParent(i)?this._isFreeformChild(i,n)&&this._addFreeformChild(t,r,e):this._addNodeChild(t,r,e,i,n)}))}_addNodeChild(e,t,i,n,r){const s=this._createNode(e);if(null==i[t])i[t]=s;else{if(!this._isCollection(n,r))throw new Error(`Multiple values for ${n}.${r}`);i[t].push(s)}}_addFreeformChild(e,t,i){i[t]=i[t]||[],i[t].push(this._createFreeformNode(e))}_convertPropertyValue(e,t,i){const n=null!=this._types[t]?this._types[t][i]:null;return null!=n?Ve[n](e):e}_isCollection(e,t){return We(this._collections,e,t)}_isFreeformParent(e){return null!=this._freeforms[e]}_isFreeformChild(e,t){return We(this._freeforms,e,t)}_isHybrid(e){return this._hybrids.indexOf(e)>=0}constructor({collections:e,freeforms:t,hybrids:i,types:n}){this._collections=e,this._freeforms=t,this._hybrids=i,this._types=n}}var je={collections:{AdVerifications:["Verification"],Companion:["CompanionClickTracking"],CompanionAds:["Companion"],CreativeExtensions:["CreativeExtension"],Creatives:["Creative"],Extensions:["Extension"],Icon:["IconViewTracking"],IconClicks:["IconClickTracking"],Icons:["Icon"],InLine:["Category","Error","Impression","Survey"],MediaFiles:["MediaFile","InteractiveCreativeFile"],NonLinear:["NonLinearClickTracking"],NonLinearAds:["NonLinear"],TrackingEvents:["Tracking"],VAST:["Error","Ad"],Verification:["JavaScriptResource","FlashResource"],ViewableImpression:["Viewable","NotViewable","ViewUndetermined"],VideoClicks:["ClickTracking","CustomClick"],Wrapper:["Impression","Error"]},freeforms:{CreativeExtensions:["CreativeExtension"],Extensions:["Extension"]},hybrids:["CompanionAds"],types:{Ad:{sequence:De.int},AdParameters:{xmlEncoded:De.bool},Companion:{width:De.int,height:De.int,expandedWidth:De.int,expandedHeight:De.int},Creative:{sequence:De.int},Duration:{_value:De.time},Icon:{width:De.int,height:De.int,offset:De.time,duration:De.time},MediaFile:{bitrate:De.int,minBitrate:De.int,maxBitrate:De.int,width:De.int,height:De.int,scalable:De.bool,maintainAspectRatio:De.bool},NonLinear:{width:De.int,height:De.int,assetWidth:De.int,assetHeight:De.int,expandedWidth:De.int,expandedHeight:De.int,scalable:De.bool,maintainAspectRatio:De.bool,minSuggestedDuration:De.time},Pricing:{_value:De.float},Wrapper:{followAdditionalWrappers:De.bool,allowMultipleAds:De.bool,fallbackOnNoAd:De.bool}}};class ze{get sequence(){return this._sequence}set sequence(e){this._sequence=e}constructor(){this._sequence=null}}class qe{get length(){return this._contents.length}add(e){this._contents.push(e),this._contents.sort(((e,t)=>(e.sequence||0)-(t.sequence||0)))}remove(e){let t=this._contents.indexOf(e);for(;t>=0;)this._contents.splice(t,1),t=this._contents.indexOf(e,t)}get(e){return this._contents[e]}clear(){this._contents.length=0}[Symbol.iterator](){const e=this;let t=0;return{next:()=>t<e.length?{value:e.get(t++),done:!1}:{value:void 0,done:!0}}}toArray(){return this._contents.slice()}get $type(){return"SortedList"}constructor(){this._contents=[]}}class Ge extends ze{get id(){return this._id}set id(e){this._id=e}get conditionalAd(){return this._conditionalAd}set conditionalAd(e){this._conditionalAd=e}get adSystem(){return this._adSystem}set adSystem(e){this._adSystem=e}get impressions(){return this._impressions}get pricing(){return this._pricing}set pricing(e){this._pricing=e}get errors(){return this._errors}get viewableImpression(){return this._viewableImpression}set viewableImpression(e){this._viewableImpression=e}get verifications(){return this._verifications}get extensions(){return this._extensions}get creatives(){return this._creatives}constructor(){super(),this._id=null,this._conditionalAd=!1,this._adSystem=null,this._impressions=[],this._pricing=null,this._errors=[],this._viewableImpression=null,this._verifications=[],this._extensions=[],this._creatives=new qe}}class Xe extends Ge{get adTitle(){return this._adTitle}set adTitle(e){this._adTitle=e}get categories(){return this._categories}get description(){return this._description}set description(e){this._description=e}get advertiser(){return this._advertiser}set advertiser(e){this._advertiser=e}get surveys(){return this._surveys}get $type(){return"InLine"}constructor(){super(),this._adTitle=null,this._categories=[],this._description=null,this._surveys=[]}}class Ye extends Ge{get followAdditionalWrappers(){return this._followAdditionalWrappers}set followAdditionalWrappers(e){this._followAdditionalWrappers=e}get allowMultipleAds(){return this._allowMultipleAds}set allowMultipleAds(e){this._allowMultipleAds=e}get fallbackOnNoAd(){return this._fallbackOnNoAd}set fallbackOnNoAd(e){this._fallbackOnNoAd=e}get vastAdTagURI(){return this._vastAdTagURI}set vastAdTagURI(e){this._vastAdTagURI=e}get $type(){return"Wrapper"}constructor(){super(),this._followAdditionalWrappers=!0,this._allowMultipleAds=!1,this._fallbackOnNoAd=!1,this._vastAdTagURI=null}}class Je{get clickThrough(){return this._clickThrough}set clickThrough(e){this._clickThrough=e}get clickTrackings(){return this._clickTrackings}constructor(){this._clickThrough=null,this._clickTrackings=[]}}class Qe extends Je{get $type(){return"IconClicks"}}class Ke extends Je{get customClicks(){return this._customClicks}get $type(){return"VideoClicks"}constructor(){super(),this._customClicks=[]}}class Ze{get version(){return this._version}set version(e){this._version=e}get name(){return this._name}set name(e){this._name=e}get $type(){return"AdSystem"}constructor(){this._version=null,this._name=null}}class et{get authority(){return this._authority}set authority(e){this._authority=e}get code(){return this._code}set code(e){this._code=e}get $type(){return"Category"}constructor(){this._authority=null,this._code=null}}class tt{get id(){return this._id}set id(e){this._id=e}get uri(){return this._uri}set uri(e){this._uri=e}get $type(){return"Click"}constructor(){this._id=null,this._uri=null}}class it extends ze{get id(){return this._id}set id(e){this._id=e}get adID(){return this._adID}set adID(e){this._adID=e}get apiFramework(){return this._apiFramework}set apiFramework(e){this._apiFramework=e}get universalAdId(){return this._universalAdId}set universalAdId(e){this._universalAdId=e}get extensions(){return this._extensions}get linear(){return this._linear}set linear(e){this._linear=e}get companionAds(){return this._companionAds}set companionAds(e){this._companionAds=e}get nonLinearAds(){return this._nonLinearAds}set nonLinearAds(e){this._nonLinearAds=e}get $type(){return"Creative"}constructor(){super(),this._id=null,this._adID=null,this._apiFramework=null,this._universalAdId=null,this._extensions=[],this._linear=null,this._companionAds=null,this._nonLinearAds=null}}class nt{get program(){return this._program}set program(e){this._program=e}get width(){return this._width}set width(e){this._width=e}get height(){return this._height}set height(e){this._height=e}get xPosition(){return this._xPosition}set xPosition(e){this._xPosition=e}get yPosition(){return this._yPosition}set yPosition(e){this._yPosition=e}get duration(){return this._duration}set duration(e){this._duration=e}get offset(){return this._offset}set offset(e){this._offset=e}get apiFramework(){return this._apiFramework}set apiFramework(e){this._apiFramework=e}get pxratio(){return this._pxratio}set pxratio(e){this._pxratio=e}get resource(){return this._resource}set resource(e){this._resource=e}get clicks(){return this._clicks}set clicks(e){this._clicks=e}get viewTrackings(){return this._viewTrackings}get $type(){return"Icon"}constructor(){this._program=null,this._width=null,this._height=null,this._xPosition=null,this._yPosition=null,this._duration=null,this._offset=null,this._apiFramework=null,this._pxratio=null,this._resource=null,this._clicks=null,this._viewTrackings=[]}}class rt{get id(){return this._id}set id(e){this._id=e}get uri(){return this._uri}set uri(e){this._uri=e}get $type(){return"Impression"}constructor(){this._id=null,this._uri=null}}class st{get type(){return this._type}set type(e){this._type=e}get apiFramework(){return this._apiFramework}set apiFramework(e){this._apiFramework=e}get uri(){return this._uri}set uri(e){this._uri=e}get $type(){return"InteractiveCreativeFile"}constructor(){this._type=null,this._apiFramework=null,this._url=null}}class at{get delivery(){return this._delivery}set delivery(e){this._delivery=e}get type(){return this._type}set type(e){this._type=e}get width(){return this._width}set width(e){this._width=e}get height(){return this._height}set height(e){this._height=e}get codec(){return this._codec}set codec(e){this._codec=e}get id(){return this._id}set id(e){this._id=e}get bitrate(){return this._bitrate}set bitrate(e){this._bitrate=e}get minBitrate(){return this._minBitrate}set minBitrate(e){this._minBitrate=e}get maxBitrate(){return this._maxBitrate}set maxBitrate(e){this._maxBitrate=e}get scalable(){return this._scalable}set scalable(e){this._scalable=e}get maintainAspectRatio(){return this._maintainAspectRatio}set maintainAspectRatio(e){this._maintainAspectRatio=e}get apiFramework(){return this._apiFramework}set apiFramework(e){this._apiFramework=e}get uri(){return this._uri}set uri(e){this._uri=e}get $type(){return"MediaFile"}constructor(){this._delivery=null,this._type=null,this._width=null,this._height=null,this._codec=null,this._id=null,this._bitrate=null,this._minBitrate=null,this._maxBitrate=null,this._scalable=!1,this._maintainAspectRatio=!1,this._apiFramework=null,this._uri=null}}class ot{get model(){return this._model}set model(e){this._model=e}get currency(){return this._currency}set currency(e){this._currency=e}get value(){return this._value}set value(e){this._value=e}get $type(){return"Pricing"}constructor(){this._model=null,this._currency=null,this._value=null}}class lt{get type(){return this._type}set type(e){this._type=e}get uri(){return this._uri}set uri(e){this._uri=e}get $type(){return"Survey"}constructor(){this._type=null,this._uri=null}}class dt{get uri(){return this._uri}set uri(e){this._uri=e}get offset(){return this._offset}set offset(e){this._offset=e}get $type(){return"TrackingEvent"}constructor(){this._uri=null,this._offset=null}}class ct{get types(){return Object.keys(this._map)}get(e){return this._map[e]||[]}add(e,t){this._map[e]=this._map[e]||[],this._map[e].push(t)}get $type(){return"TrackingEvents"}constructor(){this._map=Object.create(null)}}class ut{get idRegistry(){return this._idRegistry}set idRegistry(e){this._idRegistry=e}get idValue(){return this._idValue}set idValue(e){this._idValue=e}get creativeIdentifier(){return this._creativeIdentifier}set creativeIdentifier(e){this._creativeIdentifier=e}get $type(){return"UniversalAdId"}constructor(){this._idRegistry="unknown",this._idValue="unknown",this._creativeIdentifier=null}}class ht{get ads(){return this._ads}get adPod(){return this._adPod}set adPod(e){this._adPod=e}get $type(){return"AdBuffet"}constructor(){this._ads=new qe,this._adPod=null}}class pt extends ht{get uri(){return this._uri}set uri(e){this._uri=e}get version(){return this._version}set version(e){this._version=e}get errors(){return this._errors}get $type(){return"VAST"}constructor(){super(),this._uri=null,this._version=null,this._errors=[]}}class mt{get vendor(){return this._vendor}set vendor(e){this._vendor=e}get javaScriptResources(){return this._javaScriptResources}get flashResources(){return this._flashResources}get viewableImpression(){return this._viewableImpression}set viewableImpression(e){this._viewableImpression=e}get $type(){return"Verification"}constructor(){this._vendor=null,this._javaScriptResources=[],this._flashResources=[],this._viewableImpression=null}}class gt{get id(){return this._id}set id(e){this._id=e}get viewables(){return this._viewables}get notViewables(){return this._notViewables}get viewUndetermineds(){return this._viewUndetermineds}get $type(){return"ViewableImpression"}constructor(){this._id=null,this._viewables=[],this._notViewables=[],this._viewUndetermineds=[]}}class vt{get required(){return this._required}set required(e){this._required=e}get companions(){return this._companions}get xmlElement(){return this._xmlElement}set xmlElement(e){this._xmlElement=e}get $type(){return"CompanionAds"}constructor(){this._required=null,this._companions=[],this._xmlElement=null}}class ft{get id(){return this._id}set id(e){this._id=e}get width(){return this._width}set width(e){this._width=e}get height(){return this._height}set height(e){this._height=e}get assetWidth(){return this._assetWidth}set assetWidth(e){this._assetWidth=e}get assetHeight(){return this._assetHeight}set assetHeight(e){this._assetHeight=e}get expandedWidth(){return this._expandedWidth}set expandedWidth(e){this._expandedWidth=e}get expandedHeight(){return this._expandedHeight}set expandedHeight(e){this._expandedHeight=e}get apiFramework(){return this._apiFramework}set apiFramework(e){this._apiFramework=e}get adSlotID(){return this._adSlotID}set adSlotID(e){this._adSlotID=e}get pxratio(){return this._pxratio}set pxratio(e){this._pxratio=e}get resource(){return this._resource}set resource(e){this._resource=e}get adParameters(){return this._adParameters}set adParameters(e){this._adParameters=e}get altText(){return this._altText}set altText(e){this._altText=e}get clickThrough(){return this._clickThrough}set clickThrough(e){this._clickThrough=e}get clickTrackings(){return this._clickTrackings}get trackingEvents(){return this._trackingEvents}set trackingEvents(e){this._trackingEvents=e}get $type(){return"Companion"}constructor(){this._id=null,this._width=null,this._height=null,this._assetWidth=null,this._assetHeight=null,this._expandedWidth=null,this._expandedHeight=null,this._apiFramework=null,this._adSlotID=null,this._pxratio=null,this._resource=null,this._adParameters=null,this._altText=null,this._clickThrough=null,this._clickTrackings=[],this._trackingEvents=null}}class wt{get skipoffset(){return this._skipoffset}set skipoffset(e){this._skipoffset=e}get duration(){return this._duration}set duration(e){this._duration=e}get mezzanine(){return this._mezzanine}set mezzanine(e){this._mezzanine=e}get mediaFiles(){return this._mediaFiles}get interactiveCreativeFiles(){return this._interactiveCreativeFiles}get adParameters(){return this._adParameters}set adParameters(e){this._adParameters=e}get videoClicks(){return this._videoClicks}set videoClicks(e){this._videoClicks=e}get trackingEvents(){return this._trackingEvents}set trackingEvents(e){this._trackingEvents=e}get icons(){return this._icons}get $type(){return"Linear"}constructor(){this._skipoffset=null,this._duration=null,this._mezzanine=null,this._mediaFiles=[],this._interactiveCreativeFiles=[],this._adParameters=null,this._videoClicks=null,this._trackingEvents=null,this._icons=[]}}class _t{get nonLinears(){return this._nonLinears}get trackingEvents(){return this._trackingEvents}set trackingEvents(e){this._trackingEvents=e}get $type(){return"NonLinearAds"}constructor(){this._nonLinears=[],this._trackingEvents=null}}class yt{get id(){return this._id}set id(e){this._id=e}get width(){return this._width}set width(e){this._width=e}get height(){return this._height}set height(e){this._height=e}get expandedWidth(){return this._expandedWidth}set expandedWidth(e){this._expandedWidth=e}get expandedHeight(){return this._expandedHeight}set expandedHeight(e){this._expandedHeight=e}get scalable(){return this._scalable}set scalable(e){this._scalable=e}get maintainAspectRatio(){return this._maintainAspectRatio}set maintainAspectRatio(e){this._maintainAspectRatio=e}get minSuggestedDuration(){return this._minSuggestedDuration}set minSuggestedDuration(e){this._minSuggestedDuration=e}get apiFramework(){return this._apiFramework}set apiFramework(e){this._apiFramework=e}get resource(){return this._resource}set resource(e){this._resource=e}get adParameters(){return this._adParameters}set adParameters(e){this._adParameters=e}get clickThrough(){return this._clickThrough}set clickThrough(e){this._clickThrough=e}get clickTrackings(){return this._clickTrackings}get $type(){return"NonLinear"}constructor(){this._id=null,this._width=null,this._height=null,this._expandedWidth=null,this._expandedHeight=null,this._scalable=!1,this._maintainAspectRatio=!1,this._minSuggestedDuration=null,this._apiFramework=null,this._resource=null,this._adParameters=null,this._clickThrough=null,this._clickTrackings=[]}}class xt{get type(){return this._type}set type(e){this._type=e}get xmlElement(){return this._xmlElement}set xmlElement(e){this._xmlElement=e}constructor(){this._type=null,this._xmlElement=null}}class bt extends xt{get $type(){return"CreativeExtension"}}class kt extends xt{get $type(){return"Extension"}}class Ct{get uri(){return this._uri}set uri(e){this._uri=e}constructor(){this._uri=null}}class Et extends Ct{get $type(){return"HTMLResource"}}class Tt extends Ct{get $type(){return"IFrameResource"}}class At extends Ct{get creativeType(){return this._creativeType}set creativeType(e){this._creativeType=e}get $type(){return"StaticResource"}constructor(){super(),this._creativeType=null}}class Pt extends Ct{get apiFramework(){return this._apiFramework}set apiFramework(e){this._apiFramework=e}constructor(){super(),this._apiFramework=null}}class St extends Pt{get $type(){return"FlashResource"}}class It extends Pt{get $type(){return"JavaScriptResource"}}class Ft{get value(){return this._value}set value(e){this._value=e}constructor(){this._value=null}}class Mt extends Ft{get $type(){return"AbsoluteTimeOffset"}}class Rt extends Ft{get $type(){return"RelativeTimeOffset"}}class Lt{get ads(){return this._ads}get $type(){return"AdPod"}constructor(){this._ads=new qe}}var Ot=e=>{const t=new Ze;return t.version=e.version,t.name=e._value,t},Nt=e=>{const t=new ut;return null!=e.idRegistry&&(t.idRegistry=e.idRegistry),null!=e.idValue&&(t.idValue=e.idValue),t.creativeIdentifier=e._value,t},Dt=e=>{const t=new bt;return t.type=e.type,t.xmlElement=e._value,t},Ut=e=>{const t=new at;return t.id=e.id,t.delivery=e.delivery,t.type=e.type,t.bitrate=e.bitrate,t.minBitrate=e.minBitrate,t.maxBitrate=e.maxBitrate,t.width=e.width,t.height=e.height,t.scalable=e.scalable,t.maintainAspectRatio=e.maintainAspectRatio,t.codec=e.codec,t.apiFramework=e.apiFramework,t.uri=e._value,t},Bt=e=>{const t=new st;return t.type=e.type,t.apiFramework=e.apiFramework,t.uri=e._value,t},Vt=e=>{const t=new At;return t.creativeType=e.creativeType,t.uri=e._value,t},Ht=e=>{const t=new Tt;return t.uri=e._value,t},Wt=e=>{const t=new Et;return t.uri=e._value,t},$t=e=>null!=e.staticResource?Vt(e.staticResource):null!=e.iFrameResource?Ht(e.iFrameResource):null!=e.htmlResource?Wt(e.htmlResource):null,jt=e=>{const t=new tt;return t.id=e.id,t.uri=e._value,t},zt=e=>"string"==typeof e&&e.length>0,qt=e=>null!=e&&zt(e._value),Gt=e=>{const t=new Qe;return null!=e.iconClickThrough&&qt(e.iconClickThrough)&&(t.clickThrough=jt(e.iconClickThrough)),null!=e.iconClickTracking&&t.clickTrackings.push(...e.iconClickTracking.filter(qt).map(jt)),t},Xt=e=>Array.isArray(e)&&e.length>0;const Yt=(e,t)=>null==e?e:t.indexOf(e)<0?parseInt(e,0):e;var Jt=e=>{const t=new nt;return t.program=e.program,t.width=e.width,t.height=e.height,t.xPosition=Yt(e.xPosition,["left","right"]),t.yPosition=Yt(e.yPosition,["top","bottom"]),t.duration=e.duration,t.offset=e.offset,t.apiFramework=e.apiFramework,t.pxratio=e.pxratio,t.resources=$t(e),null!=e.iconClicks&&(qt(e.iconClicks.iconClickThrough)||Xt(e.iconClicks.iconClickTracking))&&(t.clicks=Gt(e.iconClicks)),null!=e.iconViewTracking&&t.viewTrackings.push(...e.iconViewTracking.filter(qt).map(jt)),t},Qt=(e,t,i)=>{if("%"===e.charAt(e.length-1)){const t=new Rt;return t.value=parseFloat(e.substr(0,e.length-1)),t}{const i=new Mt;try{i.value=Be(e)}catch(n){t.errorHandler.tryRecover(n)}return i}},Kt=(e,t,i)=>{if(null!=e&&Array.isArray(e.tracking))for(const r of e.tracking){if(!zt(r._value))continue;const e=new dt;if(e.uri=r._value,zt(r.offset))try{e.offset=Qt(r.offset)}catch(n){i.errorHandler.tryRecover(n)}t.add(r.event,e)}};var Zt=(e,t)=>{const i=e.linear,n=new wt;var r,s;return zt(i.skipoffset)&&(n.skipoffset=Qt(i.skipoffset,t)),null!=i.duration&&(n.duration=i.duration._value),null!=i.mediaFiles&&(null!=i.mediaFiles.mezzanine&&(n.mezzanine=i.mediaFiles.mezzanine._value),null!=i.mediaFiles.mediaFile&&n.mediaFiles.push(...i.mediaFiles.mediaFile.map(Ut)),null!=i.mediaFiles.interactiveCreativeFile&&n.interactiveCreativeFiles.push(...i.mediaFiles.interactiveCreativeFile.map(Bt))),null!=i.adParameters&&(n.adParameters=i.adParameters._value),null!=i.videoClicks&&(n.videoClicks=new Ke,r=i.videoClicks,s=n.videoClicks,null!=r.clickThrough&&qt(r.clickThrough)&&(s.clickThrough=jt(r.clickThrough)),null!=r.clickTracking&&s.clickTrackings.push(...r.clickTracking.filter(qt).map(jt)),null!=r.customClick&&s.customClicks.push(...r.customClick.filter(qt).map(jt))),null!=i.trackingEvents&&Xt(i.trackingEvents.tracking)&&(n.trackingEvents=new ct,Kt(i.trackingEvents,n.trackingEvents,t)),null!=i.icons&&i.icons.icon&&n.icons.push(...i.icons.icon.map(Jt)),n},ei=e=>{const t=new yt;return t.id=e.id,t.width=e.width,t.height=e.height,t.expandedWidth=e.expandedWidth,t.expandedHeight=e.expandedHeight,t.scalable=e.scalable,t.maintainAspectRatio=e.maintainAspectRatio,t.minSuggestedDuration=e.minSuggestedDuration,t.apiFramework=e.apiFramework,t.resource=$t(e),null!=e.adParameters&&(t.adParameters=e.adParameters._value),null!=e.nonLinearClickThrough&&qt(e.nonLinearClickThrough)&&(t.clickThrough=jt(e.nonLinearClickThrough)),null!=e.nonLinearClickTracking&&t.clickTrackings.push(...e.nonLinearClickTracking.filter(qt).map(jt)),t},ti=e=>{const t=e.nonLinearAds,i=new _t;return null!=t.nonLinear&&i.nonLinears.push(...t.nonLinear.map(ei)),null!=t.trackingEvents&&Xt(t.trackingEvents.tracking)&&(i.trackingEvents=new ct,Kt(t.trackingEvents,i.trackingEvents)),i},ii=e=>{const t=new ft;return t.id=e.id,t.width=e.width,t.height=e.height,t.assetWidth=e.assetWidth,t.assetHeight=e.assetHeight,t.expandedWidth=e.expandedWidth,t.expandedHeight=e.expandedHeight,t.apiFramework=e.apiFramework,t.adSlotID=e.adSlotID,t.pxratio=e.pxratio,t.resource=$t(e),null!=e.adParameters&&qt(e.adParameters)&&(t.adParameters=e.adParameters._value),null!=e.altText&&qt(e.altText._value)&&(t.altText=e.altText._value),null!=e.companionClickThrough&&qt(e.companionClickThrough)&&(t.clickThrough=jt(e.companionClickThrough)),null!=e.companionClickTracking&&t.clickTrackings.push(...e.companionClickTracking.filter(qt).map(jt)),null!=e.trackingEvents&&Xt(e.trackingEvents.tracking)&&(t.trackingEvents=new ct,Kt(e.trackingEvents,t.trackingEvents)),t},ni=e=>{const t=e.companionAds,i=new vt;return i.required=t.required,null!=t.companion&&i.companions.push(...t.companion.map(ii)),i.xmlElement=t._value,i},ri=(e,t)=>{const i=new it;return i.id=e.id,i.sequence=e.sequence,i.adID=e.AdID||e.adID||e.adId,i.apiFramework=e.apiFramework,null!=e.universalAdId&&(i.universalAdId=Nt(e.universalAdId)),null!=e.creativeExtensions&&e.creativeExtensions.creativeExtension&&i.extensions.push(...e.creativeExtensions.creativeExtension.map(Dt)),null!=e.linear?i.linear=Zt(e,t):null!=e.nonLinearAds&&(i.nonLinearAds=ti(e)),null!=e.companionAds&&(i.companionAds=ni(e)),null==i.linear&&null==i.nonLinearAds&&null==i.companionAds&&t.errorHandler.tryRecover("Creative has no ads"),i},si=e=>{const t=new kt;return t.type=e.type,t.xmlElement=e._value,t},ai=e=>{const t=new rt;return t.id=e.id,t.uri=e._value,t},oi=e=>{const t=new ot;return t.model=e.model,t.currency=e.currency,t.value=e._value,t},li=e=>{const t=new gt;return t.id=e.id,null!=e.viewable&&t.viewables.push(...e.viewable.map((e=>e._value))),null!=e.notViewable&&t.notViewables.push(...e.notViewable.map((e=>e._value))),null!=e.viewUndetermined&&t.viewUndetermineds.push(...e.viewUndetermined.map((e=>e._value))),t},di=e=>{const t=new It;return t.apiFramework=e.apiFramework,t.uri=e._value,t},ci=e=>{const t=new St;return t.apiFramework=e.apiFramework,t.uri=e._value,t},ui=e=>{const t=new mt;return t.vendor=e.vendor,null!=e.javaScriptResource&&t.javaScriptResources.push(...e.javaScriptResource.map(di)),null!=e.flashResource&&t.flashResources.push(...e.flashResource.map(ci)),null!=e.viewableImpression&&(t.viewableImpression=e.viewableImpression._value),null!=e.verificationParameters&&(t.parameters=e.verificationParameters._value),t};const hi=e=>null!=e&&zt(e._value);var pi=(e,t,i,n)=>(i.id=e.id,i.conditionalAd=e.conditionalAd,i.sequence=e.sequence,null!=t.adSystem&&(i.adSystem=Ot(t.adSystem)),null!=t.impression&&i.impressions.push(...t.impression.filter(hi).map(ai)),null!=t.pricing&&(i.pricing=oi(t.pricing)),null!=t.error&&i.errors.push(...t.error.filter(hi).map((e=>e._value))),null!=t.viewableImpression&&(i.viewableImpression=li(t.viewableImpression)),null!=t.adVerifications&&t.adVerifications.verification.forEach((e=>{try{const t=ui(e);i.verifications.push(t)}catch(t){n.errorHandler.tryRecover(t)}})),null!=t.extensions&&i.extensions.push(...t.extensions.extension.map(si)),null!=t.creatives&&t.creatives.creative.forEach((e=>{try{const t=ri(e,n);i.creatives.add(t)}catch(t){n.errorHandler.tryRecover(t)}})),i),mi=e=>{const t=new et;return t.authority=e.authority,t.code=e._value,t},gi=e=>{const t=new lt;return t.type=e.type,t.uri=e._value,t},vi=(e,t)=>{const i=new Xe,n=e.inLine;return pi(e,n,i,t),i.adTitle=null!=n.adTitle?n.adTitle._value:null,null!=n.category&&i.categories.push(...n.category.filter((e=>null!=e.authority)).map(mi)),i.description=null!=n.description?n.description._value:null,i.advertiser=null!=n.advertiser?n.advertiser._value:null,null!=n.survey&&i.surveys.push(...n.survey.filter((e=>e._value.length>0)).map(gi)),i},fi=(e,t)=>{const i=new Ye,n=e.wrapper;return pi(e,n,i,t),null!=n.followAdditionalWrappers&&(i.followAdditionalWrappers=n.followAdditionalWrappers),null!=n.allowMultipleAds&&(i.allowMultipleAds=n.allowMultipleAds),i.fallbackOnNoAd=n.fallbackOnNoAd,i.vastAdTagURI=null!=n.vastAdTagURI?n.vastAdTagURI._value:null,i},wi=(e,t)=>{if(null!=e.inLine)return vi(e,t);if(null!=e.wrapper)return fi(e,t);throw new Error("Unrecognized ad type")};var _i=(e,t)=>{const i=new pt;i.version=e.version,i.errors.push(...e.error.map((e=>e._value)).filter((e=>""!==e)));const[n,r]=(e=>{const t=[],i=[];for(let n=0;n<e.length;++n){const r=e[n];void 0!==r.sequence?t.push(r):i.push(r)}return[t,i]})(e.ad);if(n.length>0)if(t.noSingleAdPods&&1===e.ad.length&&1===n.length)r.push(n[0]);else{i.adPod=new Lt;for(let e=0;e<n.length;e++)i.adPod.ads.add(wi(n[e],t))}for(let s=0;s<r.length;s++)i.ads.add(wi(r[s],t));return i},yi={XML_PARSING_ERROR:100,VAST_SCHEMA_VALIDATION_ERROR:101};class xi extends K{constructor(e,t){super(e),this.code=t,this.name="VASTParserError"}}class bi{failWithErrorCode(e,t){if(e instanceof xi)throw e;throw new xi(e instanceof Error?e.message:e,t)}fail(e){this.failWithErrorCode(e,yi.VAST_SCHEMA_VALIDATION_ERROR)}tryRecover(e){this._strictMode&&this.fail(e)}constructor(e){this._strictMode=e}}const ki={strict:!1,noSingleAdPods:!1};var Ci=(e,t={})=>{(t=Object.assign({},ki,t)).errorHandler=new bi(t.strict);const i=((e,t)=>{"string"==typeof e&&(e=(t.domParser||new DOMParser).parseFromString(e,"text/xml"));return null!=e.documentElement&&(e=e.documentElement),e.getElementsByTagName("parsererror").length>0&&t.errorHandler.failWithErrorCode("XML parsing error",yi.XML_PARSING_ERROR),e})(e,t),n=new $e(je);try{const e=n.unmarshal(i);return _i(e,t)}catch(r){t.errorHandler.fail(r)}};class Ei extends(e(H)){constructor(e,t=null,i=null){super(e),this.cause=t,this.uri=i,this.$type="VASTLoaderError"}}class Ti extends K{constructor(e,t){super(`HTTP ${e}`+(null!=t&&""!==t?`: ${t}`:"")),this.status=e,this.statusText=t,this.$type="HTTPError"}}const Ai=/^data:(.*?)(;\s*base64)?,(.*)/,Pi={maxDepth:10,credentials:"omit",timeout:1e4,noSingleAdPods:!1,prepareUri:e=>e};class Si extends(e(be)){load(){return this._load(this._uri).catch((e=>{throw this._emit("error",{error:e}),e}))}_load(e){return Promise.resolve().then((()=>{this._emit("willFetch",{uri:e});const t=Ai.exec(e);return null==t?this._fetchUri(e):this._parseDataUri(t[3],t[1],null!=t[2])})).then((({headers:t,body:i})=>{this._emit("didFetch",{uri:e,headers:t,body:i}),this._emit("willParse",{uri:e,headers:t,body:i});const n=Ci(i,{noSingleAdPods:this._options.noSingleAdPods});if(n.uri=e,this._emit("didParse",{uri:e,headers:t,body:i,vast:n}),n.ads.length>0){const e=n.ads.get(0);if(e instanceof Ye||"Wrapper"===e.$type)return this._loadWrapped(e.vastAdTagURI,n)}else if(this._depth>1)throw new Ei(303,null,e);return[n]}))}_parseDataUri(e,t,i){return{body:i?Si.atob(e):decodeURIComponent(e)}}_loadWrapped(e,t){return Promise.resolve().then((()=>{const{maxDepth:t}=this._options;if(t>0&&this._depth+1>=t)throw new Ei(302,null,e);return new Si(e,null,this).load()})).then((e=>[t,...e]))}_fetchUri(e){const t=this._options.prepareUri(e),i=this._fetchWithCredentials(t),n=this._createTimeouter(i,t);return Promise.race([i,n]).then((e=>(n.cancel(),e))).catch((e=>{if(n.cancel(),this._depth>1)throw new Ei(301,null,t);throw e}))}_fetchWithCredentials(e){let{credentials:t}=this._options;return"function"==typeof t&&(t=t(e)),Array.isArray(t)||(t=[t]),t.reduce(((t,i)=>t.catch((()=>this._tryFetch(e,i)))),Promise.reject(new Error))}_tryFetch(e,t){return this._root._fetch(e,{credentials:t}).then((t=>{if(!t.ok){const i=new Ti(t.status,t.statusText);throw new Ei(301,i,e)}return t.text().then((e=>({headers:t.headers,body:e})))})).catch((i=>{throw this._emit("fetchError",{uri:e,credentials:t,error:i}),i}))}_createTimeouter(e,t){const i=this._options.timeout;let n=null;const r=new Promise(((e,r)=>{n=setTimeout((()=>{r(new Ei(301,null,t))}),i)}));return r.cancel=()=>{null!=n&&(clearTimeout(n),n=null)},r}_emit(...e){this._root.emit(...e)}constructor(e,t,i){super(),this._uri=e,null!=i?(this._root=i._root,this._options=this._root._options,this._depth=i._depth+1):(this._root=this,this._options=Object.assign({},Pi,t),this._depth=1,this._fetch=null!=this._options.fetch?this._options.fetch:Si.fetch)}}const Ii="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";Si.fetch=function(e,t){return t=t||{},new Promise((function(i,n){var r=new XMLHttpRequest,s=[],a=[],o={},l=function(){return{ok:2==(r.status/100|0),statusText:r.statusText,status:r.status,url:r.responseURL,text:function(){return Promise.resolve(r.responseText)},json:function(){return Promise.resolve(r.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([r.response]))},clone:l,headers:{keys:function(){return s},entries:function(){return a},get:function(e){return o[e.toLowerCase()]},has:function(e){return e.toLowerCase()in o}}}};for(var d in r.open(t.method||"get",e,!0),r.onload=function(){r.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,(function(e,t,i){s.push(t=t.toLowerCase()),a.push([t,i]),o[t]=o[t]?o[t]+","+i:i})),i(l())},r.onerror=n,r.withCredentials="include"==t.credentials,t.headers)r.setRequestHeader(d,t.headers[d]);r.send(t.body||null)}))},Si.atob=e=>{let t="",i=0;do{const n=Ii.indexOf(e.charAt(i++)),r=Ii.indexOf(e.charAt(i++)),s=Ii.indexOf(e.charAt(i++)),a=(63&n)<<2|r>>4&3,o=(15&r)<<4|s>>2&15,l=(3&s)<<6|63&Ii.indexOf(e.charAt(i++));t+=String.fromCharCode(a)+(o?String.fromCharCode(o):"")+(l?String.fromCharCode(l):"")}while(i<e.length);return t};const Fi={maxDepth:5,timeout:2e3,credentials:"omit"};function Mi(t,i=Fi){const n=new Si(`data:text/xml;base64,${t}`,i),r={parsedLayers:[],errorPixels:[],impressionPixels:[],mediaFiles:[],durationInSeconds:0,clickThroughUrl:null,clickTrackingPixels:[],trackingEvents:{},parserErrorThrown:null};return n.on("didParse",(({_uri:t,_body:i,vast:n})=>{!function(t,i){if(i.parsedLayers.push(t),0===t.ads.length)throw new(e(H))(v.NO_AD);if(1!==t.ads.length)throw new(e(H))(v.UNEXPECTED_AD_TYPE);!function(t,i){t.errors&&i.errorPixels.push(...t.errors);t.impressions&&i.impressionPixels.push(...t.impressions.map((e=>e.uri)));if(t.creatives&&0!==t.creatives.length){if(1!==t.creatives.length)throw new(e(H))(v.UNEXPECTED_AD_TYPE);!function(t,i){if(!t.linear||t.nonLinearAds)throw new(e(H))(v.UNEXPECTED_LINEARITY);!function(e,t){e.duration&&(t.durationInSeconds=e.duration);e.mediaFiles&&t.mediaFiles.push(...e.mediaFiles);e.trackingEvents&&function(e,t){var i;for(const n of e.types){t.trackingEvents[n]||(t.trackingEvents[n]=[]);for(const r of e.get(n))null===(i=t.trackingEvents[n])||void 0===i||i.push(r.uri)}}(e.trackingEvents,t);e.videoClicks&&function(e,t){e.clickThrough&&(t.clickThroughUrl=e.clickThrough.uri);t.clickTrackingPixels.push(...e.clickTrackings.map((e=>e.uri)))}(e.videoClicks,t)}(t.linear,i)}(t.creatives.get(0),i)}else;}(t.ads.get(0),i)}(n,r)})).load().catch((e=>{r.parserErrorThrown=e})).then((()=>r))}const Ri="adfetch_request",Li="adfetch_punt",Oi="adfetch_error",Ni="adfetch_noad",Di="adfetch_renderad",Ui="adfetch_rendererror",Bi="adfetch_httperror",Vi="sfImpression",Hi="LightAdImpression",Wi="viewablelatency",$i=(e,t,i)=>({csaKey:e,csmKey:t,csmMessage:i}),ji=($i("bodyBegin","bb",Vi),$i("bodyBegin","bb",Hi),$i("bodyEnd","be")),zi=($i("clickToATF","af"),$i("criticalFeature","cf"),$i("criticalFeature","cf",Vi),$i("criticalFeature","cf",Hi),$i("loaded","ld")),qi=$i("loaded","ld",Vi),Gi=($i("loaded","ld",Hi),$i("viewablelatency:bodyBegin","bb",Wi),$i("viewablelatency:loaded","ld",Wi),"adload_renderstart"),Xi="adload_renderend",Yi="viewability",Ji="unservedviewability",Qi="adload:renderstart",Ki="adload:renderend",Zi="adload:viewability",en="adload:unservedviewability",tn=async(e,t,i,n,r)=>{const s={callBackReceived:!0,errFallback:e.handleFallbackBehavior.name};if(i&&0!==Object.keys(i).length){switch(s.adContent=i,s.status=i.status,i.status){case"punt":e.countMetric(Li,1),e.logCsaEvent(Li),n.aaxInstrPixelUrl=i.instrPixelURL,yn(e,n,t),s.aaxReturnedPunt=!0;break;case"error":e.countMetric(Oi,1),e.logCsaEvent(Oi),e.handleFallbackBehavior(),s.aaxReturnedError=!0;break;default:try{n.aaxImpPixelUrl=i.impPixelURL,n.aaxInstrPixelUrl=i.instrPixelURL,n.htmlContent=i.creative,n.measurementHtml=null==i?void 0:i.aaxMeasurementTrackers.html,n.adFeedbackInfo&&(n.adFeedbackInfo.adProgramId=`${i.programId}`),n.adCreativeMetaData&&(n.adCreativeMetaData.adProgramId=`${i.programId}`,n.adCreativeMetaData.adImpressionId=i.impPixelURL,"null"!==(null==i?void 0:i.creativeIdStr)&&(n.adCreativeMetaData.adCreativeId=i.creativeIdStr),n.adCreativeMetaData.adCreativeTemplateName=i.creativeTemplateName,"null"!==(null==i?void 0:i.adIdStr)&&(n.adCreativeMetaData.adId=i.adIdStr)),s.aaxReturnedContent=!0,e.sendAdBarTrace("aaxCall",s),await r(n.htmlContent,n.measurementHtml),e.countMetric(Di,1),e.logCsaEvent(Di)}catch(a){e.logError("Faiure",a),e.handleFallbackBehavior(),e.countMetric(Ui,1),e.logCsaEvent(Ui),s.error="renderError"}}window.adReporterConfig&&t.sendMessage("saveAdDetailsForAdReporter",n)}else e.countMetric(Ni,1),e.logCsaEvent(Ni),e.handleFallbackBehavior(),s.error="emptyAAXResponse";e.sendAdBarTrace("aaxCall",s)},nn=e=>e?e.toLowerCase().replace(/[^0-9a-z]/g,""):"unknown",rn=(e,t,i)=>{if(t&&t.adCreativeMetaData&&0!==Object.keys(t.adCreativeMetaData).length){const n=nn(t.adCreativeMetaData.adCreativeTemplateName);e.addCsmTag("adrender"),e.addCsmTag("adrender:safeframe"),e.addCsmTag("adrender","creativetemplatename:"+n),i.sendMessage("addCsaEntity",{adrender:"true",creativeTemplateName:n,isLightAds:"false"}),t.adCreativeMetaData.adCreativeId&&(e.addCsmTag("adrender","creativeid:"+t.adCreativeMetaData.adCreativeId),i.sendMessage("addCsaEntity",{creativeId:t.adCreativeMetaData.adCreativeId.toString()})),t.adCreativeMetaData.adProgramId&&(e.addCsmTag("adrender","programid:"+t.adCreativeMetaData.adProgramId),i.sendMessage("addCsaEntity",{adProgramId:t.adCreativeMetaData.adProgramId.toString()})),void 0!==t.isCardsFlow&&i.sendMessage("addCsaEntity",{isCardsFlow:t.isCardsFlow.toString()})}else e.addCsmTag("noadrender"),i.sendMessage("addCsaEntity",{adrender:"false"})},sn=async(e,t,i)=>{i.countMetric(Qi,1),i.logCsaEvent(Gi),i.sendAdBarTrace("renderHtmlContentStart",{readyState:document.readyState});const n=hn();if(t.renderCompleteTime&&"complete"!==document.readyState&&null!==document.currentScript){let t=document.currentScript;for(t.insertAdjacentHTML("afterend",e),t=t.nextElementSibling;null!==t;)"SCRIPT"===t.tagName?pn(t):gn(t),t=t.nextElementSibling}else mn(e),cn(),gn(document.documentElement);t.ensureGlobals(),await n,await async function(){const e=document.querySelectorAll("img"),t=Array.from(e).filter(vn).map((e=>new Promise((t=>{e.addEventListener("load",(()=>{t()}),{once:!0})}))));await Promise.all(t)}(),t.renderCompleteTime=new Date,window.addEventListener("load",(()=>{t.isLdFired||(t.isLdFired=!0,i.sendLatencyMetric(zi))})),window.addEventListener("load",i.fireViewableLatencyMetrics),i.countMetric(Ki,1),i.logCsaEvent(Xi),i.sendAdBarTrace("renderHtmlContentEnd",{readyState:document.readyState})},an="creativeReplayStatus",on="iscomplete",ln="creativeReplayComplete",dn=`document.dispatchEvent(new CustomEvent("${ln}"));`,cn=()=>{document.body.innerHTML+=`<script id="${an}">${dn}<\/script>`},un=e=>{var t;return null===(t=document.getElementById(an))||void 0===t?void 0:t.setAttribute(e,"true")},hn=()=>new Promise(((e,t)=>{const i=document.getElementById(an);if("true"===(null==i?void 0:i.getAttribute(on)))e();else{document.addEventListener(ln,(()=>{un(on),e()}),{once:!0});const n=5e3;setTimeout((()=>{"true"!==(null==i?void 0:i.getAttribute(on))&&t(new Error(`Creative script replay not detected within ${n} timeout`))}),n)}})),pn=e=>{var t,i;const n=document.createRange();n.selectNode(e);const r=n.createContextualFragment(e.outerHTML).firstElementChild;if(r.getAttribute("src"))r.async=!1;else{const t=e.innerHTML;r.async=!1,r.setAttribute("src",`data:text/javascript;charset=UTF-8,${encodeURIComponent(t)}`)}null===(t=e.parentNode)||void 0===t||t.insertBefore(r,e.nextSibling),null===(i=e.parentNode)||void 0===i||i.removeChild(e)},mn=e=>{if(null==document.documentElement){const e=document.createElement("html");document.appendChild(e)}document.documentElement.innerHTML=e},gn=e=>{const t=e.querySelectorAll("script");for(const i of t)pn(i)},vn=e=>{!e.complete||(e=>e.naturalWidth>0||e.naturalHeight>0)(e)||(e=>{0===e.height||e.width})(e)};const fn="cod_client",wn=async(e,t)=>{await new Promise((i=>document.addEventListener("loadAdWithRelocatedHtmlContent",(async n=>{await(async i=>{const n=r(i.detail.htmlContentEncoded),s=r(t||"");await e(n,s)})(n),i()}),{once:!0})))},_n=()=>{try{Object&&Object.defineProperty&&"function"==typeof Object.defineProperty?Object.defineProperty(document,"cookie",{get:function(){return""},set:function(){}}):(document.__defineGetter__("cookie",(function(){return""})),document.__defineSetter__("cookie",(function(){})))}catch(e){}},yn=(e,t,i)=>{t.isNoInventory=!0,rn(e,t,i),i.sendMessage("startPixelTracking",{measurementMethod:fn,isNoInventory:t.isNoInventory})},xn=e=>{var t;return null!==(t=null==e?void 0:e.replace(/^http:/,"https:"))&&void 0!==t?t:e},bn=(e,t)=>{console.error(e,t)};let kn=null,Cn=null,En=null,Tn=null,An=null;const Pn=new class{viewabilityStandards(){return Tn=Tn||[],Tn}payload(){return En=En||{},En}},Sn={ext:{inViewPercentage:()=>(kn=kn||0,Math.round(100*kn)),geom:()=>(Cn=Cn||{},Cn)}},In={playingTime:()=>(An=An||0,An)},Fn=()=>Pn,Mn=()=>In,Rn=e=>{var t,i,n,r;kn=void 0!==(null===(i=null===(t=null==e?void 0:e.geom)||void 0===t?void 0:t.self)||void 0===i?void 0:i.iv)?null===(r=null===(n=null==e?void 0:e.geom)||void 0===n?void 0:n.self)||void 0===r?void 0:r.iv:null,null===kn&&delete Sn.ext.inViewPercentage,Cn=void 0!==(null==e?void 0:e.geom)?null==e?void 0:e.geom:null,null===Cn&&delete Sn.ext.geom,En=void 0!==(null==e?void 0:e.payload)?null==e?void 0:e.payload:null,null===En&&delete Pn.payload,Tn=void 0!==(null==e?void 0:e.viewabilityStandards)?null==e?void 0:e.viewabilityStandards:null,null===Tn&&delete Pn.viewabilityStandards};var Ln=function(e,t,i){if(""===t)throw new Error("Invalid queryParamKey input to addJSONQueryParamToURL: "+JSON.stringify({queryParamKey:t}));var n=new URL(e),r=n.searchParams.get(t),s=r||"{}",a=JSON.parse(s),o=Object.assign(a,i);return n.searchParams.set(t,JSON.stringify(o)),n.toString()};const On=(e,t,i)=>{let n=e+t;return i&&(n+="_"+i),n},Nn=async(e,{pixelUrl:t,id:i,baseCounterName:n,baseMetricName:r,counterExtension:s},a)=>{try{return!(e=>!!document.getElementById(e))(i)&&(e.logCsaEvent(On(r,"fired",s)),e.countMetric(On(n,"fired",s),1),e.sendAdBarTrace("pixels",{fired:{pixelUrl:t,additionalTrace:a}}),await fetch(t,{keepalive:!0,mode:"no-cors"}),document.getElementsByTagName("body")[0].appendChild(((e,t)=>{const i=document.createElement("img");return i.id=e,i.style.display="none",i.setAttribute("pixel-url",t),i})(i,t)),e.countMetric(On(n,"loaded",s),1),e.logCsaEvent(On(r,"loaded",s)),e.sendAdBarTrace("pixels",{loaded:{pixelUrl:t,additionalTrace:a}}),!0)}catch(o){throw e.countMetric(On(n,"error",s),1),e.logCsaEvent(On(r,"error",s)),e.sendAdBarTrace("pixels",{error:{pixelUrl:t,additionalTrace:a}}),e.logError(`Error firing pixels: ${t}`,o),o}},Dn=(e,t,i)=>e+t+JSON.stringify(i),Un="impressionFired",Bn="btr:impression",Vn="viewable",Hn="not_viewable";class Wn{constructor(){this._viewableStartTimeInMilliseconds=void 0,this._currentState=Hn,this._isCurrentlyInNotViewableState=()=>this._currentState===Hn,this.transitionToViewableState=e=>{this._isCurrentlyInNotViewableState()&&(this._viewableStartTimeInMilliseconds=e),this._currentState=Vn},this.transitionToNotViewableState=()=>{this._currentState=Hn},this.getViewableTimeInSeconds=e=>this._isCurrentlyInNotViewableState()||void 0===this._viewableStartTimeInMilliseconds?0:(e-this._viewableStartTimeInMilliseconds)/1e3}}var $n=function(e){return e.complete&&e.naturalHeight>0&&e.naturalWidth>0},jn=function(e){return 1===e.naturalHeight&&1===e.naturalWidth},zn=function(e){var t=e.getElementsByClassName("mrc-btr-creative"),i=t.length>0;if(i){var n=function(e){for(var t=[],i=0,n=0,r=0;r<e.length;r++){var s=e[r];s instanceof HTMLImageElement&&($n(s)?(t.push({src:s.src,isLoaded:!0}),n++):(t.push({src:s.src,isLoaded:!1}),i++))}return{isBTRCompliant:n>0&&0===i,imagesData:t}}(t);return{isBTRTaggedCreative:i,isBTRCompliant:n.isBTRCompliant,imagesData:n.imagesData}}var r=function(e){for(var t=[],i=0,n=0,r=0;r<e.length;r++){var s=e[r];s instanceof HTMLImageElement&&($n(s)?jn(s)||(t.push({src:s.src,isLoaded:!0}),i++):(t.push({src:s.src,isLoaded:!1}),n++))}return{isBTRCompliant:i>0&&0===n,imagesData:t}}(e.getElementsByTagName("img"));return{isBTRTaggedCreative:i,isBTRCompliant:r.isBTRCompliant,imagesData:r.imagesData}};const qn=e=>"Image"===e||"Image - mobile O&O"===e,Gn=async e=>{const t=await fetch(e,{keepalive:!0});if(t.ok)return await t.json();throw new Error(`Failed to fetch ad from ${e} due to ${t.status}`)};class Xn{constructor(e,t,i){this.c=e,this.o=t,this.cms=i,this.viewedPixels={},this._viewableTimeCalculators={},this.hasLoaded=!1,this.fireImageLoaded=e=>{var t,i;if(!this.hasLoaded&&qn(e)){const e=null===(t=document.getElementsByClassName("ad-background-image"))||void 0===t?void 0:t[0];if(e&&"IMG"===e.tagName)if(e.complete)this.c.countMetric("imageLoaded",1,!0),this.c.countMetric("imageLoaded:adid:"+this.o.adCreativeMetaData.adId,1,!0),this.hasLoaded=!0;else{const t=null===(i=e.onload)||void 0===i?void 0:i.bind(window);e.onload=e=>{t&&t(e),this.c.countMetric("imageLoaded",1,!0),this.c.countMetric("imageLoaded:adid:"+this.o.adCreativeMetaData.adId,1,!0),this.hasLoaded=!0}}}},this.fireImpressionPixel=async(e,t)=>{if(t)await Nn(this.c,{id:"ape_ni_impression",pixelUrl:Dn(this.o.aaxInstrPixelUrl,"nii/",{ni:!0}),baseCounterName:"adload:unservedimpression",baseMetricName:"unservedimpression"});else{const t=this.o.adCreativeMetaData.adProgramId?this.o.adCreativeMetaData.adProgramId:"unknown",i=this.o.adCreativeMetaData.adCreativeTemplateName,n=nn(i),r=this.o.adCreativeMetaData.adId;let s=!1;const a=Jn(this.o.aaxImpPixelUrl,e);s="btr_client"===e;await Nn(this.c,{id:"ape_impression",pixelUrl:a,baseCounterName:"adload:impression",baseMetricName:"impression"})&&(this.c.countMetric(Un,1,!0),this.c.countMetric(Un+":program:"+t,1,!0),this.c.countMetric(Un+":template:"+n,1,!0),s&&(this.c.countMetric(Bn,1,!1),this.c.countMetric(Bn,1,!0),this.c.countMetric(Bn+":program:"+t,1,!0),this.c.countMetric(Bn+":template:"+n,1,!0)),qn(i)&&this.c.countMetric(Un+":adid:"+r,1,!0))}},this.fireMeasurabilityPixel=e=>{if(l(this.o)||l(this.c)||!this.o.aaxInstrPixelUrl)return;const t="ape_measurability";this.viewedPixels[t]||(Nn(this.c,{id:t,pixelUrl:Dn(this.o.aaxInstrPixelUrl,"atf/",{atf:e.atf}),baseCounterName:"adload:measurability",baseMetricName:"measurability"}),this.viewedPixels[t]={})},this.fireViewablePixelsForVideo=(e,t,i,n,r)=>{if(l(this.o)||l(this.c)||!this.o.aaxInstrPixelUrl||!i)return;const s=i=>{var r,s;t.v=i;const a=null===(r=this.o.computed)||void 0===r?void 0:r.aPageStart,o=null===(s=this.o.computed)||void 0===s?void 0:s.adStartTime;t.ptv=a?(Date.now()-a)/1e3:0,t.ttv=o?(Date.now()-o)/1e3:0,n&&(t.niv=!0);const l={viewableInfo:t,aaxInstrPixelUrl:this.o.aaxInstrPixelUrl,viewablePercentage:e};let d;n?(d=Dn(this.o.aaxInstrPixelUrl,"niv/",t),Nn(this.c,{id:"ape_ni_viewability_"+i.def,pixelUrl:d,baseCounterName:en,baseMetricName:Ji,counterExtension:i.def},l)):(d=Dn(this.o.aaxInstrPixelUrl,"v/",t),Nn(this.c,{id:"ape_viewability_"+i.def,pixelUrl:d,baseCounterName:Zi,baseMetricName:Yi,counterExtension:i.def},l))},a=(e,t)=>{const i=e.def;t&&Yn(t,e.p)?this._viewableTimeCalculators[i].transitionToViewableState(Date.now()):this._viewableTimeCalculators[i].transitionToNotViewableState();const n=this._viewableTimeCalculators[i].getViewableTimeInSeconds(Date.now()),a=!this.viewedPixels[i].viewed&&((e,t,i)=>{const n=e>=i.t,r=t&&t>=i.t;return n&&r})(n,r,e);a&&(this.viewedPixels[i].viewed=!0,s(e))};for(let o=0;o<i.length;o++){const e=i[o].def;e&&(this.viewedPixels[e]=this.viewedPixels[e]||{},this.viewedPixels[e].viewed=void 0!==this.viewedPixels[e].viewed&&this.viewedPixels[e].viewed,void 0===this._viewableTimeCalculators[e]&&(this._viewableTimeCalculators[e]=new Wn))}for(let o=0;o<i.length;o++)a(i[o],e)},this.fireViewablePixels=(e,t,i,n)=>{var r;const s=i=>{var r,s;t.v=i;const a=null===(r=this.o.computed)||void 0===r?void 0:r.aPageStart,o=null===(s=this.o.computed)||void 0===s?void 0:s.adStartTime;t.ptv=a?(Date.now()-a)/1e3:0,t.ttv=o?(Date.now()-o)/1e3:0,n&&(t.niv=!0);const l={viewableInfo:t,aaxInstrPixelUrl:this.o.aaxInstrPixelUrl,viewablePercentage:e};let d;n?(d=Dn(this.o.aaxInstrPixelUrl,"niv/",t),Nn(this.c,{id:"ape_ni_viewability_"+i.def,pixelUrl:d,baseCounterName:en,baseMetricName:Ji,counterExtension:i.def},l)):(d=Dn(this.o.aaxInstrPixelUrl,"v/",t),Nn(this.c,{id:"ape_viewability_"+i.def,pixelUrl:d,baseCounterName:Zi,baseMetricName:Yi,counterExtension:i.def},l))},a=t=>{const i=t.p,n=t.t,r=t.def;!this.viewedPixels[r].viewed&&e&&Yn(e,i)?this.viewedPixels[r].timeout||(this.viewedPixels[r].timeout=setTimeout((()=>{this.viewedPixels[r].viewed=!0,s(t)}),1e3*n)):this.viewedPixels[r].timeout&&(clearTimeout(this.viewedPixels[r].timeout),this.viewedPixels[r].timeout=null)};for(const o of i){const e=o.def;(null===(r=this.viewedPixels)||void 0===r?void 0:r[e])||(this.viewedPixels[e]={viewed:!1,timeout:null}),a(o)}}}}const Yn=(e,t)=>100*e>=t&&0!==t||100*e>t&&0===t,Jn=(e,t)=>Ln(e,"pj",{measurementMethod:t}),Qn=()=>{var e;return(document,e=document.body,zn(e)).isBTRCompliant?"btr_client":"cod_client"},Kn=async e=>{if(e.includes("mrc-btr-creative")){if("btr_client"===Qn())return Promise.resolve("btr_client");const e=new Promise((e=>{const t=new MutationObserver(((t,i)=>{for(const n of t){const t=n.target;(null==t?void 0:t.complete)&&(null==t?void 0:t.naturalHeight)>0&&(null==t?void 0:t.naturalWidth)>0&&(i.disconnect(),e())}}));t.observe(document.body,{subtree:!0,childList:!0,attributeFilter:["complete","naturalWidth","naturalHeight"]}),setTimeout((()=>{e(),t.disconnect()}),50)}));return await e,Promise.resolve(Qn())}return Promise.resolve(Qn())};class Zn{constructor(e,t){this.weblabsWindow=e,this.prefix=t,this.isT1=()=>"t1"===this.weblabTreatment(),this.isC=()=>"c"===this.weblabTreatment(),this.weblabTreatment=()=>{var e,t,i;return null===(i=null===(t=null===(e=this.weblabsWindow)||void 0===e?void 0:e.renderingWeblabs)||void 0===t?void 0:t[this.prefix])||void 0===i?void 0:i.toLowerCase()}}}const er=()=>new Zn(window,"ADPT_SF_DEALS_REFACTOR_820101"),tr=e=>["mobile-auto-top-advertising-0","auto-top-advertising-0"].includes(e)&&new Zn(window,"ADPT_SF_SPARKLE_838607").isT1();class ir{constructor(e,i,n,r){this.cms=e,this.o=i,this.mL=n,this.renderFallbackExperience=r,this.expandAdSlot=e=>{this.cms.sendMessage("expandAdSlot",e)},this.expandAdSlotWithOverlap=e=>{this.cms.sendMessage("expandAdSlotWithOverlap",e)},this.resetSlotSize=()=>{this.cms.sendMessage("resetSlotSize")},this.fireImpression=async e=>{this.sendLatencyMetric(qi),await this.cr.fireImpressionPixel(e.measurementMethod,e.isNoInventory),this.cms.sendMessage("clearCODFallback")},this.sendAdBarTrace=(e,t)=>{this.cms.sendMessage("sendAdBarTrace",{field:e,traceInfo:t})},this.changeSize=(e,t)=>{this.cms.sendMessage("changeSize",{width:e,height:t})},this.logCsaEvent=e=>{this.cms.sendMessage("logCsaEvent",{metricName:e})},this.addCsaEntity=e=>{this.cms.sendMessage("addEntity",e)},this.registerCustomMessageListener=(e,t)=>{this.mL[e]=t},this.sendLatencyMetric=e=>{this.cms.sendMessage("sendLatencyMetric",{latencyMetricType:e,timestamp:new Date})},this.countMetric=(e,t,i)=>{this.cms.sendMessage("countMetric",{metricMsg:e,value:t,isGlobal:!!i})},this.addCsmTag=(e,t,i)=>{this.cms.sendMessage("addCsmTag",{tag:e,msg:t,isGlobal:i})},this.fireViewableLatencyMetrics=()=>{this.cms.sendMessage("fireViewableLatencyMetrics",{adLoadedTimestamp:Date.now()})},this.feedbackLabelRendered=()=>{this.cms.sendMessage("feedbackLabelRendered")},this.feedbackOpenModal=()=>{this.cms.sendMessage("feedbackOpenModal")},this.customMessage=(e,t)=>{this.cms.sendMessage("customMessage",{key:e,body:t})},this.updateViewability=e=>{var i,n,r,s,a;const o=Fn();if(Rn(e),!this.o.aaxInstrPixelUrl||!o.payload||!o.viewabilityStandards)return;this.o.isNoInventory||void 0===e.atf||this.cr.fireMeasurabilityPixel(e);const l=(null===(n=null===(i=null===window||void 0===window?void 0:window.$sf)||void 0===i?void 0:i.ext)||void 0===n?void 0:n.geom)&&(null===(r=null===window||void 0===window?void 0:window.$sf)||void 0===r?void 0:r.ext.geom()),d=(null===(s=null==l?void 0:l.self)||void 0===s?void 0:s.iv)?null===(a=null==l?void 0:l.self)||void 0===a?void 0:a.iv:null;if(t(this.o.mediaType)){const e=Mn();this.cr.fireViewablePixelsForVideo(d,o.payload(),o.viewabilityStandards(),!!this.o.isNoInventory,e.playingTime?e.playingTime():null)}else this.cr.fireViewablePixels(d,o.payload(),o.viewabilityStandards(),!!this.o.isNoInventory)},this.updatePlayingTimeForVideo=e=>{var t,i,n;const r=Fn();An=e,null===An&&delete In.playingTime;const s=(null===(i=null===(t=null===window||void 0===window?void 0:window.$sf)||void 0===t?void 0:t.ext)||void 0===i?void 0:i.geom)&&window.$sf.ext.geom(),a=null===(n=null==s?void 0:s.self)||void 0===n?void 0:n.iv;if(a&&r.payload&&r.viewabilityStandards){const e=Mn();this.cr.fireViewablePixelsForVideo(a,r.payload(),r.viewabilityStandards(),!!this.o.isNoInventory,e.playingTime?e.playingTime():null)}},this.requestVideoAutoplay=()=>{this.cms.sendMessage("requestVideoAutoplay")},this.releaseVideoAutoplay=()=>{this.cms.sendMessage("releaseVideoAutoplay")},this.haveVideoAutoplayPermission=()=>{this.cms.sendMessage("haveVideoAutoplayPermission")},this.isOnAmazon=()=>!0,this.sendRelocatedHtmlContentEncodedToAd=e=>{const t=new window.CustomEvent("loadAdWithRelocatedHtmlContent",{detail:{htmlContentEncoded:e}});document.dispatchEvent(t)},this.collapseSlotInternal=()=>{this.logAPIInvocation("collapseSlot"),this.cms.sendMessage("collapseSlot")},this.logError=(e,t,i)=>{this.cms.sendMessage("logError",{message:e,error:t,level:i})},this.collapseSlot=()=>{this.handleFallbackBehavior()},this.handleFallbackBehavior=()=>{this.logAPIInvocation("handleFallbackBehavior"),this.renderFallbackExperience()},this.handleFallbackExperience=()=>{this.cms.sendMessage("handleFallbackExperience")},this.resizeCreativeWrapper=e=>{const t=window.document.getElementById(`ape_${i=this.o,tr(i.slotName)?i.renderingId:i.placementName}_creativeWrapper`);var i;null!==t&&(t.style.height=e.height,t.style.width=e.width)},this.triggerEventInIframe=e=>{window.dispatchEvent(new Event("outerpage"+e.eventType))},this.logAPIInvocation=(e,...t)=>{this.cms.sendMessage("logAPIInvocation",{apiName:e,apiParams:t}),this.cms.sendMessage("logCsaEvent",{metricName:"messenger_"+e})},this.setupComputedAdDetails=e=>{this.o.computed=e.computed},this.cr=new Xn(this,i,e)}}class nr{constructor(e,t){this.o=e,this.messagePort=t,this.sendMessage=(e,t)=>{const i={command:e,arid:null==this?void 0:this.o.arid,data:t||{}};try{this.messagePort.postMessage(i)}catch(n){bn("Post Message error",n)}}}}class rr{constructor(e,t,i){this.c=e,this.o=t,this.mL=i,this.pendingMessages=new Map,this.waitForMessageProcessed=async e=>new Promise((t=>this.pendingMessages.set(e,t))),this.receiveMessage=e=>{try{const i=e.data,n=i.command?i.command.split("."):[];let r=this.c[n[0]];for(let e=1;e<n.length&&r;e++)r=r[n[e]];if("customMessage"===i.command){const e=i.data.key,n=i.data.data;if("function"==typeof this.mL[e])try{this.mL[e](n)}catch(t){this.c.logError("Custom Message Listener Error",t)}}else r&&(r(i.data),sr(i.command,this.pendingMessages))}catch(t){return void this.c.logError("Error with "+e.data.command,t)}}}}const sr=(e,t)=>{const i=null==t?void 0:t.get(e);null==i||i(),null==t||t.delete(e)},ar="adfetch:request",or="adfetch:httperror";new Map;var lr=function(){var e;return"function"==typeof(null===(e=null===window||void 0===window?void 0:window.ue)||void 0===e?void 0:e.count)},dr=function(e,t){var i;return null===(i=null===window||void 0===window?void 0:window.ue)||void 0===i?void 0:i.count(e,t)},cr="adplacements",ur=function(e){return e.startsWith(cr)?e:"".concat(cr,":").concat(e)},hr=function(e,t){pr("ERROR",e,t)},pr=function(e,t,i){var n,r;console.error(t,mr(t,i)),n="safeFrameError",void 0===r&&(r=1),lr()&&dr(ur(n),r),window.ueLogError&&window.ueLogError(mr(t,i),{logLevel:e,attribution:"APE-safeframe",message:gr(t,i)+" | "})},mr=function(e,t){return t instanceof Error?t:t?new Error(t):new Error(e)},gr=function(e,t){return t instanceof Error?e+": "+t.message:e},vr=new RegExp(/((&#\d{2,4};)|(&[a-z]{2};)|(&[a-z]{3,7};)|(%[a-fA-F0-9]{2})|(\W))pd_rd_plhdr(=|%3D)t((&#\d{2,4};)|(&[a-z]{2,7};)|(%[a-fA-F0-9]{2})|(\W))/),fr="$1",wr="$8",_r=function(e,t){var i=t,n=e;if("&pd_rd_plhdr=t"===e||""===e.trim())return i;(n=n.replace(/&amp;/g,"&")).startsWith("&")&&(n=n.replace(/^&+/,"")),n.endsWith("&")&&(n=n.replace(/&+$/,""));try{var r=void 0,s=0;do{if(s++,!(r=i.match(vr)))break;var a=r[1],o=r[8],l=r[7],d=a.startsWith("&")&&a.endsWith(";")||o.startsWith("&")&&o.endsWith(";"),c=a.startsWith("%")&&o.startsWith("%")&&"%3D"===l;i=d?i.replace(vr,fr+n.replace(/&/g,"&amp;")+wr):c?i.replace(vr,fr+encodeURIComponent(n)+wr):i.replace(vr,fr+n+wr)}while(r&&s<10)}catch(u){return t}return i},yr="data-val",xr=function(e,t,i){return function(e){if(""===e)return"";var t=document.getElementById("ape_"+e+"_placement_ClickTracking");return t&&t.hasAttribute(yr)&&t.getAttribute(yr)||""}([e,i,t].join("_"))};const br=(e,t,i)=>{try{t.countMetric(Qi,1),t.logCsaEvent(Gi),window.setupOMVideoPlayer(e,i),t.countMetric(Ki,1),t.logCsaEvent(Xi)}catch(n){t.handleFallbackBehavior()}};class kr{async getAd(){return{creative:await this.creative(),measurementHtml:this.getMeasurementHtml()}}constructor(e,t,i,n){this.htmlContentEncoded=e,this.htmlContentEncodedLength=t,this.measurementHtmlEncoded=i,this.ilmRelocatedHtmlIsActive=n,this.creative=async()=>{if(this.htmlContentEncoded)return this.decodeHtmlContent(this.htmlContentEncoded);if(this.ilmRelocatedHtmlIsActive)return Promise.resolve(Cr());throw new Error("No html content found on a server side fetch")},this.decodeHtmlContent=e=>{const t=this.htmlContentEncodedLength?e:r(e);if(this.htmlContentEncodedLength&&t.length!==this.htmlContentEncodedLength)throw new Error(`Mismatched expected htmlContentEncoded size. Expected ${this.htmlContentEncodedLength} but got ${t.length}`);return t},this.getMeasurementHtml=()=>r(this.measurementHtmlEncoded?this.measurementHtmlEncoded:"")}}const Cr=()=>new Promise((e=>document.addEventListener("loadAdWithRelocatedHtmlContent",(async t=>{var i,n;e(r(null!==(n=null===(i=t.detail)||void 0===i?void 0:i.htmlContentEncoded)&&void 0!==n?n:""))}),{once:!0})));class Er{async getAd(){var e;try{this.sfApi.countMetric(ar,1),this.sfApi.logCsaEvent(Ri);const t=await Gn(xn(this.aaxUrl));switch(null==t?void 0:t.status){case"ok":return Promise.resolve({creative:t.creative,measurementHtml:null===(e=t.aaxMeasurementTrackers)||void 0===e?void 0:e.html,creativeTemplateName:t.creativeTemplateName,instrumentationPixelUrl:t.instrPixelURL,impressionPixelUrl:t.impPixelURL});case"punt":this.sfApi.countMetric(Li,1),this.sfApi.logCsaEvent(Li);break;case"error":this.sfApi.countMetric(Oi,1),this.sfApi.logCsaEvent(Oi);break;default:this.sfApi.countMetric(Ni,1),this.sfApi.logCsaEvent(Ni)}}catch(t){this.sfApi.countMetric(or,1),this.sfApi.logCsaEvent(Bi),this.sfApi.logError("Couldn't fetch Ad From AAX.",t)}throw new Error("Could not fetch creative html")}constructor(e,t){this.sfApi=e,this.aaxUrl=t}}const Tr=(e,t,i)=>{var n,r;switch(e){case"XSP_CLIENT_SIDE":return new Er(i,t.src);case"XSP_SERVER_SIDE":return new kr(t.htmlContentEncoded,t.htmlContentEncodedLength,null!==(n=t.measurementHtmlEncoded)&&void 0!==n?n:"",!!(null===(r=t.expParams)||void 0===r?void 0:r.ilmRelocatedHtmlIsActive));default:throw new Error("Wrong creative flow provided")}},Ar=e=>{if(!("pageType"in e)||!("subPageType"in e)||!("slotName"in e))return"";try{return xr(e.pageType,e.subPageType,e.slotName)}catch(t){return""}};class Pr{handleServerSideFetchAd(){var e,t;const i={serverSide:null===(e=this.o)||void 0===e?void 0:e.serverSideFetchAd};let n;if(this.o.htmlContentEncoded){const e=this.o.htmlContentEncodedLength?this.o.htmlContentEncoded:r(this.o.htmlContentEncoded);this.o.htmlContentEncodedLength&&e.length!==this.o.htmlContentEncodedLength&&console.debug(`Mismatched expected htmlContentEncoded size. Expected ${this.o.htmlContentEncodedLength} but got ${e.length}.  This is likely harmless.`);const t=r(this.o.measurementHtmlEncoded?this.o.measurementHtmlEncoded:"");i.htmlContent=e,n=async()=>{await this.loadAd(e,t)}}else{if(!(null===(t=this.o.expParams)||void 0===t?void 0:t.ilmRelocatedHtmlIsActive))throw new Error("No html content found on a server side fetch");n=async()=>{var e;await wn(this.loadAd,null!==(e=this.o.measurementHtmlEncoded)&&void 0!==e?e:"")}}return{writeAdHandler:n,adRenderFlowTrace:i}}renderFallbackStaticAdHelper(){}loadAdPlatformSpecific(e){return e}constructor(e,n,r,s,a){this.o=e,this.mp=n,this.mL=r,this.cms=s,this.c=a,this.isLdFired=!1,this.renderCompleteTime=null,this.hasCODFallbackRegistered=!1,this.isDone=!1,this.initSFClient=async()=>{this.ensureGlobals(),_n(),window.navigator&&window.navigator.geolocation&&(window.navigator.geolocation.watchPosition=(e,t,i)=>0,window.navigator.geolocation.getCurrentPosition=()=>{}),document.write=this.documentWriteDelegate,document.open=(...e)=>{this.nativeOpen(...e),this.ensureGlobals()},this.mp.onmessage=this.cmr.receiveMessage,this.c.sendLatencyMetric(ji),this.cms.sendMessage("safeFrameReady"),await this.cmr.waitForMessageProcessed("setupComputedAdDetails"),this.c.countMetric("adload:iframeinitialized",1),this.c.logCsaEvent("adload_iframeinitialized"),((e,t)=>{t.disableResizeFunc||e.sendMessage("resizeSafeFrameAd"),t.resizePlacementStyle&&e.sendMessage("setResizePlacementStyle")})(this.cms,this.o),window.writeAdHandler=await this.setupWriteAdHandler(),await window.writeAdHandler(),Sr(this.mL,this.cms,this.o)},this.setupWriteAdHandler=async()=>{var e,t,i;if(Mr(this.o))return async()=>this.forceRenderFallbackExperience();if(!er().isT1()){const{writeAdHandler:e,adRenderFlowTrace:t}="true"===this.o.serverSideFetchAd?this.handleServerSideFetchAd():this.handleClientSideFetchAd();return this.c.sendAdBarTrace("adRenderFlow",t),e}try{const n="true"===this.o.serverSideFetchAd?"XSP_SERVER_SIDE":"XSP_CLIENT_SIDE",r=await Tr(n,this.o,this.c).getAd();return this.o.htmlContent=r.creative,this.o.measurementHtml=r.measurementHtml,this.o.aaxInstrPixelUrl=null!==(e=r.instrumentationPixelUrl)&&void 0!==e?e:this.o.aaxInstrPixelUrl,this.o.aaxImpPixelUrl=null!==(t=r.impressionPixelUrl)&&void 0!==t?t:this.o.aaxImpPixelUrl,this.o.adCreativeMetaData.adImpressionId=this.o.aaxImpPixelUrl,this.o.adCreativeMetaData.adCreativeTemplateName=null!==(i=r.creativeTemplateName)&&void 0!==i?i:this.o.adCreativeMetaData.adCreativeTemplateName,()=>this.loadAd(r.creative,r.measurementHtml)}catch(n){return this.c.logError("Couldn't getAd from htmlProvider",n),async()=>this.forceRenderFallbackExperience()}},this.handleClientSideFetchAd=()=>{var e;const t={serverSide:null===(e=this.o)||void 0===e?void 0:e.serverSideFetchAd},i=xn(this.o.src);t.adSource=i,t.isXsp=!i.includes("x/getad");return{writeAdHandler:async()=>{try{this.c.countMetric(ar,1),this.c.logCsaEvent(Ri);const e=await Gn(i);await tn(this.c,this.cms,e,this.o,this.loadAd)}catch(e){this.c.countMetric(or,1),this.c.logCsaEvent(Bi),this.c.logError("AAX fetch error",e),this.c.sendAdBarTrace("aaxCall",{error:"httpError"}),this.c.handleFallbackBehavior()}},adRenderFlowTrace:t}},this.ensureGlobals=()=>{window.onerror=this.handleErrors,window.$sf=Sn,window.$sfViewableInfo=Fn(),window.aaxInstrPixelUrl=this.o.aaxInstrPixelUrl},this.documentWriteDelegate=async e=>{this.hasCODFallbackRegistered||this.o.firePixelsAfter||(this.cms.sendMessage("registerCODFallback",Jn(this.o.aaxImpPixelUrl,fn)),this.hasCODFallbackRegistered=!0),await sn(e,this,this.c),await this.done(e)},this.addOnLoadListeners=()=>{window.addEventListener("load",(()=>{this.isLdFired||(this.isLdFired=!0,this.c.sendLatencyMetric(zi))})),window.addEventListener("load",this.c.fireViewableLatencyMetrics)},this.handleErrors=(e,t,i,n,r)=>{const s=r||new Error(e.toString());return this.c.logError(s.message,s),this.renderCompleteTime||this.forceRenderFallbackExperience(),!0},this.forceRenderFallbackExperience=()=>{er().isT1()&&rn(this.c,this.o,this.cms);this.o.fallbackStaticAdImgUrl&&this.o.fallbackStaticAdClickUrl?(this.renderFallbackStaticAd(this.o.fallbackStaticAdImgUrl,this.o.fallbackStaticAdClickUrl,this.o.fallbackStaticAdExtraStyle),this.renderCompleteTime=new Date):this.c.collapseSlotInternal(),this.c.handleFallbackExperience()},this.renderFallbackStaticAd=(e,t,i)=>{const n=document.createElement("a");n.target="_top",n.href=t,n.append(((e,t)=>{const i=document.createElement("img");return i.src=e,((e,t)=>{t.split(" ").forEach((t=>{const i=t.split("=");e.setAttribute(i[0],i[1])}))})(i,t),i})(e,i)),document.body.replaceChildren(),document.body.append(n),this.renderFallbackStaticAdHelper(),this.ensureGlobals(),this.mp.onmessage=this.cmr.receiveMessage,this.isDone=!0},this.done=async e=>{const t={};if(this.isDone)t.firstInvocation=!1;else{t.firstInvocation=!0,this.isDone=!0,Fr(),Ir();const i=await Kn(e);this.cms.sendMessage("startPixelTracking",{isNoInventory:!1,measurementMethod:i}),this.o.adCreativeMetaData&&this.c.cr.fireImageLoaded(this.o.adCreativeMetaData.adCreativeTemplateName),this.c.countMetric("adload:creativewritten",1),this.c.logCsaEvent("adload_creativewritten")}document.addEventListener("touchstart",{handleEvent:()=>{}},!1),this.c.sendAdBarTrace("doneFunction",t)},this.loadAd=async(e,t)=>{var i;if(this.o.isNoInventory=!1,rn(this.c,this.o,this.cms),!this.renderCompleteTime){let n=_r(null!==(i=Ar(this.o))&&void 0!==i?i:"",e);this.isVideo()?new Zn(window,"ADPT_SF_ADSP_VIDEO_833419").isT1()?br(this.o,this.c,n):this.c.handleFallbackBehavior():(t&&(this.c.countMetric("adload:measurementhtml",1),this.c.logCsaEvent("measurementhtml"),n=n.concat(t)),n=this.loadAdPlatformSpecific(n),await this.documentWriteDelegate(n))}},this.isVideo=()=>{return e=this.o.mediaType,n=this.o.adCreativeMetaData.adProgramId,t(e)&&!i.hasOwnProperty(n);var e,n},this.cmr=new rr(a,e,this.mL),this.nativeWrite=document.write.bind(document),this.nativeOpen=document.open.bind(document),window.onerror=this.handleErrors}}const Sr=(e,t,i)=>{e.initAdReporter=e=>{var n;try{window.adReporterConfig=e;const r=document.createElement("script");r.type="text/javascript",r.async=!0,r.src=null!==(n=null==e?void 0:e.adReporterClientUrl)&&void 0!==n?n:"",(document.head||document.body).appendChild(r),t.sendMessage("saveAdDetailsForAdReporter",i)}catch(r){hr("Error appending adReporterClient script",r)}}},Ir=()=>{un("creativeLoad"),window.dispatchEvent(new Event("load"))},Fr=()=>{un("creativedomcontentloaded"),document.dispatchEvent(new Event("DOMContentLoaded"))},Mr=e=>!!("true"!==e.abpAcceptable&&e.abpStatus&&e.enableFallbackForAbpStatuses&&e.enableFallbackForAbpStatuses.indexOf(n[e.abpStatus])>-1);class Rr extends ir{constructor(e,t,i,n){super(e,t,i,n),this.isSupported=()=>!0,this.getARID=()=>this.o.arid,this.getDebugInfo=e=>{this.logAPIInvocation("getDebugInfo");const t=Or(this.o.slotName),i={slot:this.o.placementName,slotName:this.o.slotName,shazamId:null==t?void 0:t.shazamId,creativeId:null==t?void 0:t.creativeId,adId:null==t?void 0:t.adId,src:this.o.src,iframeHtml:window.document.body.innerHTML||""};this.customMessage(e.key,i)},this.sendAdInfo=e=>{e&&this.o.adCreativeMetaData&&(this.o.adCreativeMetaData=e)},this.getQueryParam=e=>{this.logAPIInvocation("getQueryParam"),this.countMetric("getqueryparam:"+e,1);let t="";const i=this.o.allowlistedQueryParamKeys?Lr(window.location.search,this.o.allowlistedQueryParamKeys):void 0;return i&&(0!==e.indexOf("sf-")&&(t="sf-"+e),t=i[t]||""),t},this.getPlacementInfo=()=>(this.logAPIInvocation("getPlacementInfo"),{slot:this.o.placementName,slotName:this.o.slotName,pageType:this.o.pageType})}}const Lr=(e,t)=>{const i=new URLSearchParams(e),n={};return i.forEach(((e,i)=>{t.includes(i)&&(n[i]=e)})),n},Or=e=>{var t;return(null===window||void 0===window?void 0:window.aanResponse)||(window.document.aanResponse?null===(t=window.document)||void 0===t?void 0:t.aanResponse[e+"adData"]:void 0)};class Nr extends Pr{constructor(e,t){const i=new nr(e,t),n={};super(e,t,n,i,new Rr(i,e,n,(()=>this.forceRenderFallbackExperience())))}}const Dr="sf iframe ready",Ur=async(e,t,i)=>{var n;try{window.dcmads=window.dcmads||{},window.dcmads.eids="4|40004007";const s=null!=i?i:await Br(t);if(s.forcePunt)return;window.renderingWeblabs=s.weblabTreatments,null===(n=null===performance||void 0===performance?void 0:performance.mark)||void 0===n||n.call(performance,"SafeFrame: SF received ad details");const a=e(t,s);try{a.initSFClient()}catch(r){a.c.logError("Could not init SafeFrame Client",r)}}catch(r){bn("Could not init ",r)}},Br=async(e,t=3e4)=>{const i=(new Date).getTime();for(;;)try{return await Vr(e)}catch(n){if((new Date).getTime()-i>t){const e=`Failed to receive adDetails from host within ${t} ms`,i=new Error(e);throw hr(e,i),i}}},Vr=async e=>new Promise(((t,i)=>{e.onmessage=e=>{const n=e.data;"adDetails"===n.command?t(n.data):i(`Incorrect message received ${n.command}`)}})),Hr=()=>{var e;null===(e=null===performance||void 0===performance?void 0:performance.mark)||void 0===e||e.call(performance,"SafeFrame: Start Send Ready"),window.parent.postMessage(Dr,"*")},Wr=e=>{var t;null===(t=null===performance||void 0===performance?void 0:performance.mark)||void 0===t||t.call(performance,`SafeFrame: Start Send Ready ${e}`);try{window.parent.dispatchEvent(new MessageEvent("message",{source:window,origin:window.location.origin,ports:[e],data:Dr}))}catch(z){window.parent.postMessage(Dr,"*",[e])}},$r=()=>""!==window.name?JSON.parse(window.name):null;window.setupOMVideoPlayer=function(e,t){const i=h();return i.countMetric(c.START,1,!1),Mi(s(t.trim())).then((t=>{if(i.countMetric(c.PARSED,1,!1),t.parserErrorThrown)throw t.parserErrorThrown;xe(t,e),i.countMetric(c.RENDERED,1,!1),i.countMetric(c.DONE,1,!1)})).catch((t=>{var i,n;const r=t.code||v.UNDEFINED;f(r,null!==(n=null===(i=e.vast)||void 0===i?void 0:i.errorPixels)&&void 0!==n?n:[])}))},window.SFClient||(e=>{const t=i=>{if(i.ports){const n=i.ports[0]?i.ports[0]:i.data;Ur(e,n),window.removeEventListener("message",t)}else console.debug("Not a MessagePort message; will continue to wait")},i=$r();if(i){const t=new MessageChannel;Ur(e,t.port1,i),Wr(t.port2)}else window.addEventListener("message",t),Hr()})(((e,t)=>{const i=new Nr(t,e);return window.SFClient=i.c,i})),"function"==typeof window.writeAdHandler&&window.writeAdHandler()})();
//# sourceMappingURL=sfVideo-1.50.f2c42e39.js.map
